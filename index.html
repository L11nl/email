<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø°ÙƒÙŠ | Smart Inventory</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    body{
      font-family:'Tajawal', sans-serif;
      background:
        radial-gradient(900px 500px at 15% -10%, rgba(59,130,246,.18), transparent 60%),
        radial-gradient(800px 500px at 90% 10%, rgba(16,185,129,.12), transparent 55%),
        #0b1224;
      color:#e2e8f0;
      overflow-x:hidden;
    }

    ::-webkit-scrollbar{ width:8px; }
    ::-webkit-scrollbar-track{ background:#070c18; }
    ::-webkit-scrollbar-thumb{ background:#3b82f6; border-radius:6px; }
    ::-webkit-scrollbar-thumb:hover{ background:#2563eb; }

    .glass-panel{
      background: rgba(15,23,42,.55);
      border: 1px solid rgba(148,163,184,.18);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .soft{
      transition: background .16s ease, border-color .16s ease, box-shadow .16s ease, transform .06s ease;
      will-change: auto;
    }

    .press-glow:active{
      box-shadow: 0 0 0 3px rgba(255,255,255,.08), 0 0 18px rgba(59,130,246,.20);
      transform: translateY(1px);
    }

    .flash{ animation: flash .22s ease-out; }
    @keyframes flash{
      0%{ box-shadow: 0 0 0 rgba(255,255,255,0); }
      100%{ box-shadow: 0 0 0 3px rgba(255,255,255,.08), 0 0 22px rgba(56,189,248,.20); }
    }

    .glow-text{
      color:#cbd5e1;
      text-shadow:
        0 0 10px rgba(56,189,248,.18),
        0 0 22px rgba(16,185,129,.10);
    }

    .field-copy{
      cursor:pointer;
      transition: background .16s ease, border-color .16s ease, box-shadow .16s ease;
    }
    .field-copy:hover{
      background-color: rgba(51,65,85,.25);
      border-color: rgba(59,130,246,.35);
      box-shadow: 0 10px 25px rgba(0,0,0,.18);
    }

    .tab-pill{
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.45);
    }
    .tab-active{
      border-color: rgba(59,130,246,.45);
      background: rgba(59,130,246,.10);
      box-shadow: 0 0 0 3px rgba(59,130,246,.12);
    }

    #snowCanvas{
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 5;
      opacity: .55;
    }

    /* ===== Settings Modal (Fix scroll + header visible) ===== */
    .modal-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      z-index: 60;
      display: none;
      align-items: flex-start;
      justify-content: center;
      padding: calc(12px + env(safe-area-inset-top)) 14px 14px 14px;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }
    .modal-backdrop.open{ display:flex; }

    .modal-card{
      width: 100%;
      max-width: 980px;
      max-height: calc(100vh - 28px - env(safe-area-inset-top));
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }

    .modal-sticky-head{
      position: sticky;
      top: 0;
      z-index: 5;
      background: rgba(15,23,42,.92);
      border-bottom: 1px solid rgba(148,163,184,.18);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 18px;
      padding: 10px 12px;
      margin-bottom: 10px;
    }

    .break-any{ word-break: break-word; overflow-wrap: anywhere; }
  </style>
</head>

<body class="min-h-screen flex flex-col items-center py-6 px-4">
  <canvas id="snowCanvas"></canvas>

  <header class="w-full max-w-5xl mb-5 flex flex-col md:flex-row justify-between items-start md:items-center gap-4 relative z-10">
    <div class="space-y-1 min-w-0">
      <h1 class="text-2xl md:text-3xl font-extrabold text-blue-400 flex items-center gap-3">
        <i class="fa-solid fa-boxes-stacked"></i>
        <span id="titleName" class="break-any">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</span>
      </h1>
      <p class="text-slate-400 text-sm">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</p>
      <p class="glow-text text-xs">
        Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù†Ø³Ø® ÙŠØ¹Ù…Ù„ Ø£ÙØ¶Ù„ Ø¹Ù„Ù‰ HTTPS Ø£Ùˆ localhost â€” ÙˆØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø«Ù‚ÙŠÙ„Ø© Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ âœ¨
      </p>
    </div>

    <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto items-start md:items-center">
      <!-- Top right: links + settings -->
      <div class="flex items-center gap-2 w-full md:w-auto">
        <div id="homeLinks" class="hidden flex-wrap gap-2"></div>
        <button id="settingsBtn" class="press-glow soft tab-pill px-3 py-2 rounded-2xl text-sm font-bold text-slate-100">
          <i class="fa-solid fa-gear ml-2 text-slate-200"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        </button>
      </div>

      <!-- Tabs -->
      <div id="tabsWrap" class="flex gap-2 flex-wrap">
        <!-- injected by JS -->
      </div>

      <div class="glass-panel soft px-5 py-3 rounded-2xl text-center shadow-lg shadow-blue-500/10">
        <span class="block text-xs text-slate-400">Ø§Ù„Ù…ØªÙˆÙØ± Ø¨Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
        <span id="stockCount" class="text-2xl font-extrabold text-emerald-300">0</span>
      </div>
      <div class="glass-panel soft px-5 py-3 rounded-2xl text-center shadow-lg shadow-purple-500/10">
        <span class="block text-xs text-slate-400">ØªÙ… Ø³Ø­Ø¨Ù‡Ø§</span>
        <span id="pulledCount" class="text-2xl font-extrabold text-purple-300">0</span>
      </div>
    </div>
  </header>

  <main class="w-full max-w-5xl space-y-5 relative z-10">

    <!-- Ø£Ø¯ÙˆØ§Øª Ø°ÙƒÙŠØ© Ø³Ø±ÙŠØ¹Ø© -->
    <section class="glass-panel soft p-4 rounded-3xl shadow-xl">
      <div class="flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
        <div class="flex items-center gap-2">
          <i class="fa-solid fa-sparkles text-amber-300"></i>
          <span class="font-extrabold text-white">Ø£Ø¯ÙˆØ§Øª Ø°ÙƒÙŠØ©</span>
          <span class="text-xs glow-text">Ø¨Ø­Ø« + Ù…Ù„Ø®Øµ + ØªØ±Ø§Ø¬Ø¹</span>
        </div>

        <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
          <div class="relative flex-1 md:w-72">
            <input id="searchInput" type="text"
              class="w-full bg-slate-950/30 text-sm text-white px-4 py-3 rounded-2xl border border-slate-700/60 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none transition placeholder-slate-500"
              placeholder="Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„)..." />
            <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
          </div>

          <button id="smartStatsBtn"
            class="press-glow soft bg-slate-800/55 hover:bg-slate-700/60 border border-slate-700/60 text-white font-bold px-4 py-3 rounded-2xl flex items-center justify-center gap-2">
            <i class="fa-solid fa-chart-simple text-emerald-300"></i>
            <span>Ù…Ù„Ø®Øµ</span>
          </button>

          <button id="undoPullBtn"
            class="press-glow soft bg-slate-800/55 hover:bg-slate-700/60 border border-slate-700/60 text-white font-bold px-4 py-3 rounded-2xl flex items-center justify-center gap-2">
            <i class="fa-solid fa-rotate-left text-amber-300"></i>
            <span>ØªØ±Ø§Ø¬Ø¹</span>
          </button>
        </div>
      </div>

      <div id="smartPanel" class="hidden mt-3 bg-slate-950/25 border border-slate-700/40 rounded-2xl p-3">
        <div class="flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
          <div class="text-sm text-slate-200 min-w-0">
            <div class="font-bold mb-1">ğŸ“Œ Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
            <div class="text-xs glow-text break-any" id="smartSummary">---</div>
          </div>
          <div class="flex flex-wrap gap-2">
            <button id="copyCompactBtn"
              class="press-glow soft bg-indigo-600/70 hover:bg-indigo-600 text-white font-bold px-4 py-2 rounded-2xl flex items-center gap-2">
              <i class="fa-solid fa-clipboard text-indigo-100"></i>
              <span>Ù†Ø³Ø® Ø³Ø·Ø±</span>
            </button>
            <button id="clearSearchBtn"
              class="press-glow soft bg-slate-800/60 hover:bg-slate-700/60 border border-slate-700/60 text-white font-bold px-4 py-2 rounded-2xl flex items-center gap-2">
              <i class="fa-solid fa-eraser text-slate-200"></i>
              <span>Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«</span>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- ØªØºØ°ÙŠØ© -->
    <section class="glass-panel soft p-5 rounded-3xl shadow-xl">
      <div class="flex justify-between items-center mb-3 gap-3">
        <h2 class="text-lg md:text-xl font-bold text-white flex items-center gap-2">
          <i class="fa-solid fa-cloud-arrow-up text-blue-400"></i>
          <span>ØªØºØ°ÙŠØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
        </h2>

        <button id="toggleBtn" class="press-glow soft text-slate-300 hover:text-white text-sm underline">
          Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø±
        </button>
      </div>

      <div id="inputSection" class="space-y-3">
        <textarea id="bulkInput" rows="4"
          class="w-full bg-slate-950/30 text-sm text-white p-4 rounded-2xl border border-slate-700/60 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none transition placeholder-slate-500"
          placeholder="Ø¶Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù‡Ù†Ø§ Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚:
email;pass;recovery;url"></textarea>

        <div class="bg-slate-950/15 border border-slate-700/40 rounded-2xl p-3">
          <div class="flex items-center gap-2 mb-2 text-slate-200">
            <i class="fa-solid fa-bolt text-amber-300"></i>
            <span class="font-bold">Ø®Ø§Ù†Ø© Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) â€” ØªÙ†Ø³ÙŠÙ‚ Ø³Ø±ÙŠØ¹</span>
          </div>
          <p class="text-xs glow-text mb-2">
            ÙƒÙ„ Ø³Ø·Ø±: <span class="font-mono text-slate-200">email@gmail.comPASSWORD</span> (Ø¨Ø¯ÙˆÙ† ÙÙˆØ§ØµÙ„)
          </p>
          <textarea id="quickInput" rows="2"
            class="w-full bg-slate-950/30 text-sm text-white p-4 rounded-2xl border border-slate-700/60 focus:border-amber-400 focus:ring-2 focus:ring-amber-400/20 outline-none transition placeholder-slate-500"
            placeholder="Ù…Ø«Ø§Ù„:
oyufezusu066@gmail.comIsbzXRgTi77up"></textarea>
        </div>

        <div class="flex flex-col md:flex-row justify-between gap-3">
          <button id="clearBtn"
            class="press-glow soft text-red-200 hover:text-red-100 transition px-4 py-2 rounded-xl border border-red-900/40 bg-red-950/20 hover:bg-red-950/30">
            <i class="fa-solid fa-trash ml-1"></i> ØªØµÙÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
          </button>

          <div class="flex flex-col sm:flex-row gap-2">
            <button id="importBtn"
              class="press-glow soft bg-slate-800/55 hover:bg-slate-700/60 border border-slate-700/60 text-white font-bold py-3 px-5 rounded-2xl flex items-center justify-center gap-2">
              <i class="fa-solid fa-file-arrow-up text-blue-300"></i>
              <span>TXT</span>
            </button>
            <input id="importFile" type="file" accept="*/*" class="hidden" />

            <button id="exportBtn"
              class="press-glow soft bg-slate-800/55 hover:bg-slate-700/60 border border-slate-700/60 text-white font-bold py-3 px-5 rounded-2xl flex items-center justify-center gap-2">
              <i class="fa-solid fa-file-arrow-down text-emerald-300"></i>
              <span>ØªØµØ¯ÙŠØ±</span>
            </button>

            <button id="addBtn"
              class="press-glow soft bg-blue-600 hover:bg-blue-500 text-white font-extrabold py-3 px-6 rounded-2xl shadow-lg shadow-blue-600/15 flex items-center justify-center gap-2">
              <i class="fa-solid fa-plus"></i>
              <span>Ø¥Ø¶Ø§ÙØ©</span>
            </button>
          </div>
        </div>

        <p class="text-[11px] glow-text">
          âœ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙŠØ¯Ø¹Ù… Ù…Ù„ÙØ§Øª Ø¨Ù‡Ø§ Ù‡ÙŠØ¯Ø± {login} ÙˆÙŠÙ‚ÙˆÙ… Ø¨ØªØ¬Ø§Ù‡Ù„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.
        </p>
      </div>
    </section>

    <div class="flex justify-center py-1">
      <button id="pullBtn"
        class="press-glow soft relative bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-400 hover:to-teal-500 text-white text-xl md:text-2xl font-black py-4 px-8 rounded-3xl shadow-2xl shadow-emerald-500/20 w-full md:w-auto">
        <div class="flex items-center justify-center gap-3">
          <i class="fa-solid fa-hand-holding-hand"></i>
          <span>Ø³Ø­Ø¨ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</span>
        </div>
      </button>
    </div>

    <section id="resultArea" class="hidden">
      <div class="glass-panel soft p-1 rounded-[26px] border border-slate-600/50 shadow-2xl">
        <div class="bg-slate-950/25 rounded-[22px] p-5">
          <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 pb-3 border-b border-slate-700/60 gap-2">
            <span class="text-emerald-300 font-extrabold text-lg flex items-center gap-2">
              <i class="fa-solid fa-check-circle"></i>
              ØªÙ… Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­
            </span>
            <span class="text-xs text-slate-400 font-mono" id="timestamp"></span>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
            <div class="press-glow field-copy soft bg-slate-950/25 p-3 rounded-2xl border border-slate-700/60 group" data-copy="email">
              <label class="text-xs text-slate-400 block mb-1">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Email)</label>
              <div class="flex justify-between items-center gap-3">
                <span id="emailDisplay" class="font-mono text-blue-300 truncate">---</span>
                <i class="fa-regular fa-copy text-slate-500 group-hover:text-white"></i>
              </div>
            </div>

            <div class="press-glow field-copy soft bg-slate-950/25 p-3 rounded-2xl border border-slate-700/60 group" data-copy="password">
              <label class="text-xs text-slate-400 block mb-1">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Password)</label>
              <div class="flex justify-between items-center gap-3">
                <span id="passDisplay" class="font-mono text-rose-300 truncate">---</span>
                <i class="fa-regular fa-copy text-slate-500 group-hover:text-white"></i>
              </div>
            </div>

            <div class="press-glow field-copy soft bg-slate-950/25 p-3 rounded-2xl border border-slate-700/60 group" data-copy="recovery">
              <label class="text-xs text-slate-400 block mb-1">Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ (Recovery Email)</label>
              <div class="flex justify-between items-center gap-3">
                <span id="recDisplay" class="font-mono text-amber-300 truncate">---</span>
                <i class="fa-regular fa-copy text-slate-500 group-hover:text-white"></i>
              </div>
            </div>

            <div class="soft bg-slate-950/25 p-3 rounded-2xl border border-slate-700/60 flex justify-between items-center gap-3">
              <div>
                <label class="text-xs text-slate-400 block mb-1">Ø±Ø§Ø¨Ø· Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Webhook)</label>
                <span class="text-xs glow-text">Ù„Ù„ÙˆØµÙˆÙ„ Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚</span>
              </div>
              <a id="urlBtn" href="#" target="_blank" rel="noopener"
                 class="press-glow soft bg-indigo-600 hover:bg-indigo-500 text-white text-sm px-4 py-2 rounded-xl transition shadow-lg shadow-indigo-600/15">
                <i class="fa-solid fa-arrow-up-right-from-square ml-1"></i> ÙØªØ­
              </a>
            </div>
          </div>

          <div class="mt-2 space-y-2">
            <button id="copyFullBtn"
              class="press-glow soft w-full bg-slate-800/55 hover:bg-slate-700/60 border border-slate-700/60 text-white font-bold py-3 rounded-2xl flex items-center justify-center gap-2 group">
              <i class="fa-solid fa-clipboard-list text-blue-300"></i>
              <span>Ù†Ø³Ø® Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙƒØ§Ù…Ù„Ø© (Ø´Ø§Ù…Ù„)</span>
            </button>

            <button id="copyEPBtn"
              class="press-glow soft w-full bg-blue-700/18 hover:bg-blue-700/25 border border-blue-700/25 text-blue-100 font-bold py-3 rounded-2xl text-sm">
              Ù†Ø³Ø® Email + Pass (Ø¨ØµÙŠØºØ© Ø§Ù„Ø®Ø¯Ù…Ø©)
            </button>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 pt-1">
              <button id="restoreBtn"
                class="press-glow soft bg-emerald-700/30 hover:bg-emerald-700/40 border border-emerald-700/35 text-emerald-100 font-bold py-3 rounded-2xl flex items-center justify-center gap-2">
                <i class="fa-solid fa-rotate-left text-emerald-300"></i>
                <span>Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†</span>
              </button>

              <button id="deleteLastBtn"
                class="press-glow soft bg-red-700/20 hover:bg-red-700/28 border border-red-700/30 text-red-100 font-bold py-3 rounded-2xl flex items-center justify-center gap-2">
                <i class="fa-solid fa-xmark text-red-300"></i>
                <span>Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©</span>
              </button>

              <button id="moveBtn"
                class="press-glow soft bg-purple-700/25 hover:bg-purple-700/35 border border-purple-700/35 text-purple-100 font-bold py-3 rounded-2xl flex items-center justify-center gap-2">
                <i class="fa-solid fa-right-left text-purple-300"></i>
                <span>Ù†Ù‚Ù„</span>
              </button>
            </div>

            <div id="moveTargets" class="hidden flex flex-wrap gap-2 pt-1"></div>

            <p class="text-center text-[11px] glow-text">
              âœ… Ø¢Ø®Ø± Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨ ÙŠØ¨Ù‚Ù‰ Ù…Ø­ÙÙˆØ¸ Ø­ØªÙ‰ Ù„Ùˆ Ø®Ø±Ø¬Øª ÙˆØ±Ø¬Ø¹Øª Ù„Ø§Ø­Ù‚Ø§Ù‹.
            </p>
          </div>

        </div>
      </div>
    </section>

  </main>

  <!-- Toast -->
  <div id="toast"
    class="fixed bottom-5 left-5 bg-slate-900/90 border border-slate-700/70 text-white px-5 py-3 rounded-2xl shadow-2xl transform translate-y-20 opacity-0 transition-all duration-300 z-[70] flex items-center gap-3">
    <i id="toastIcon" class="fa-solid fa-info-circle"></i>
    <span id="toastMsg">ØªÙ… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­</span>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal-backdrop">
    <div class="glass-panel soft modal-card rounded-3xl border border-slate-600/40 p-3">
      <div class="modal-sticky-head">
        <div class="flex items-center justify-between gap-2">
          <div class="flex items-center gap-2 min-w-0">
            <i class="fa-solid fa-gear text-slate-200"></i>
            <span class="font-extrabold text-white">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
            <span class="text-[11px] glow-text break-any">Ù…Ø®Ø²ÙˆÙ†Ø§Øª + Ø±ÙˆØ§Ø¨Ø· + ØªØ­ÙƒÙ…</span>
          </div>
          <button id="closeSettingsBtn" class="press-glow soft tab-pill px-3 py-2 rounded-2xl text-sm font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-3">
        <div class="bg-slate-950/18 border border-slate-700/35 rounded-2xl p-3">
          <div class="font-extrabold text-white mb-2">
            <i class="fa-solid fa-layer-group ml-2 text-blue-300"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†Ø§Øª
          </div>

          <div id="invList" class="space-y-2"></div>

          <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-2">
            <input id="newInvName" type="text"
              class="bg-slate-950/25 text-sm text-white px-3 py-2 rounded-2xl border border-slate-700/60 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/15 outline-none"
              placeholder="Ø§Ø³Ù… Ù…Ø®Ø²ÙˆÙ† Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ù„Ø§Ù‹: Ù†Ø¨ÙŠÙ„)" />
            <button id="addInvBtn" class="press-glow soft bg-blue-600 hover:bg-blue-500 text-white font-extrabold px-4 py-2 rounded-2xl text-sm">
              Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø²ÙˆÙ†
            </button>
            <button id="resetRulesBtn" class="press-glow soft bg-slate-800/50 hover:bg-slate-700/55 border border-slate-700/60 text-white font-bold px-4 py-2 rounded-2xl text-sm">
              Ø¥Ø¹Ø§Ø¯Ø© Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù†Ù‚Ù„
            </button>
          </div>

          <p class="mt-2 text-[11px] glow-text break-any">
            * Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ. Ø£ÙŠ Ù…Ø®Ø²ÙˆÙ† ØªØ¶ÙŠÙÙ‡ØŒ ÙŠØ·Ø¨Ù‚ Ø¹Ù„ÙŠÙ‡ Ù†ÙØ³ ÙÙƒØ±Ø© Ø§Ù„Ù†Ø³Ø® (Ø§Ø³Ù… Ø³Ù†ÙˆÙŠ + Ø§ÙŠÙ…ÙŠÙ„/Ø¨Ø§Ø³ÙˆØ±Ø¯).
          </p>
        </div>

        <div class="bg-slate-950/18 border border-slate-700/35 rounded-2xl p-3">
          <div class="font-extrabold text-white mb-2">
            <i class="fa-solid fa-link ml-2 text-emerald-300"></i> Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mb-2">
            <input id="linkName" type="text"
              class="bg-slate-950/25 text-sm text-white px-3 py-2 rounded-2xl border border-slate-700/60 outline-none"
              placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø± (Ù…Ø«Ù„Ø§Ù‹: Ù†Ø¨ÙŠÙ„)" />
            <input id="linkUrl" type="url"
              class="bg-slate-950/25 text-sm text-white px-3 py-2 rounded-2xl border border-slate-700/60 outline-none"
              placeholder="Ø§Ù„Ø±Ø§Ø¨Ø· (https://...)" />
            <button id="addLinkBtn" class="press-glow soft bg-emerald-600 hover:bg-emerald-500 text-white font-extrabold px-4 py-2 rounded-2xl text-sm">
              Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø·
            </button>
          </div>

          <div class="flex items-center gap-2 mb-2">
            <label class="text-xs text-slate-200">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø±ÙˆØ§Ø¨Ø·:</label>
            <input id="maxLinksInput" type="number" min="0" step="1"
              class="w-24 bg-slate-950/25 text-sm text-white px-3 py-2 rounded-2xl border border-slate-700/60 outline-none" />
            <button id="saveMaxLinksBtn" class="press-glow soft bg-slate-800/50 hover:bg-slate-700/55 border border-slate-700/60 text-white font-bold px-4 py-2 rounded-2xl text-sm">
              Ø­ÙØ¸
            </button>
          </div>

          <div id="linksList" class="space-y-2"></div>

          <p class="mt-2 text-[11px] glow-text break-any">
            * Ù„Ù† ÙŠØ¸Ù‡Ø± Ø£ÙŠ Ø²Ø± ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ø£Ø¶ÙØª Ø±Ø§Ø¨Ø· Ù…Ù† Ù‡Ù†Ø§.
          </p>
        </div>

        <div class="bg-slate-950/18 border border-slate-700/35 rounded-2xl p-3 lg:col-span-2">
          <div class="font-extrabold text-white mb-2">
            <i class="fa-solid fa-sliders ml-2 text-purple-300"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù‡Ù…Ø©
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-sm">
            <label class="flex items-center gap-2 bg-slate-950/20 border border-slate-700/40 rounded-2xl px-3 py-2">
              <input id="toggleSnow" type="checkbox" class="accent-blue-500">
              <span>Ø«Ù„Ø¬ Ø®ÙÙŠÙ</span>
            </label>
            <label class="flex items-center gap-2 bg-slate-950/20 border border-slate-700/40 rounded-2xl px-3 py-2">
              <input id="toggleSmart" type="checkbox" class="accent-blue-500">
              <span>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù„Ø®Øµ</span>
            </label>
            <label class="flex items-center gap-2 bg-slate-950/20 border border-slate-700/40 rounded-2xl px-3 py-2">
              <input id="toggleFeed" type="checkbox" class="accent-blue-500">
              <span>Ù‚Ø³Ù… Ø§Ù„ØªØºØ°ÙŠØ©</span>
            </label>
          </div>

          <div class="mt-3 flex flex-wrap gap-2 justify-between">
            <button id="saveSettingsBtn" class="press-glow soft bg-purple-600 hover:bg-purple-500 text-white font-extrabold px-5 py-2.5 rounded-2xl text-sm">
              Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
            <button id="resetAllBtn" class="press-glow soft bg-red-700/18 hover:bg-red-700/25 border border-red-700/25 text-red-100 font-bold px-5 py-2.5 rounded-2xl text-sm">
              ØªØµÙÙŠØ± ÙƒÙ„ Ø´ÙŠØ¡ (ÙƒÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†Ø§Øª)
            </button>
          </div>

        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // ===== DOM =====
      const stockCountEl = document.getElementById('stockCount');
      const pulledCountEl = document.getElementById('pulledCount');
      const titleNameEl = document.getElementById('titleName');
      const tabsWrap = document.getElementById('tabsWrap');
      const homeLinksEl = document.getElementById('homeLinks');

      const inputSectionEl = document.getElementById('inputSection');
      const bulkInputEl = document.getElementById('bulkInput');
      const quickInputEl = document.getElementById('quickInput');

      const searchInputEl = document.getElementById('searchInput');
      const smartStatsBtn = document.getElementById('smartStatsBtn');
      const smartPanel = document.getElementById('smartPanel');
      const smartSummary = document.getElementById('smartSummary');
      const clearSearchBtn = document.getElementById('clearSearchBtn');
      const copyCompactBtn = document.getElementById('copyCompactBtn');
      const undoPullBtn = document.getElementById('undoPullBtn');

      const resultAreaEl = document.getElementById('resultArea');
      const timestampEl = document.getElementById('timestamp');

      const emailDisplayEl = document.getElementById('emailDisplay');
      const passDisplayEl = document.getElementById('passDisplay');
      const recDisplayEl = document.getElementById('recDisplay');
      const urlBtnEl = document.getElementById('urlBtn');

      const toggleBtn = document.getElementById('toggleBtn');
      const clearBtn = document.getElementById('clearBtn');
      const addBtn = document.getElementById('addBtn');
      const pullBtn = document.getElementById('pullBtn');
      const copyFullBtn = document.getElementById('copyFullBtn');
      const copyEPBtn = document.getElementById('copyEPBtn');

      const restoreBtn = document.getElementById('restoreBtn');
      const deleteLastBtn = document.getElementById('deleteLastBtn');

      const moveBtn = document.getElementById('moveBtn');
      const moveTargetsEl = document.getElementById('moveTargets');

      const importBtn = document.getElementById('importBtn');
      const importFile = document.getElementById('importFile');
      const exportBtn = document.getElementById('exportBtn');

      const toast = document.getElementById('toast');
      const toastMsg = document.getElementById('toastMsg');
      const toastIcon = document.getElementById('toastIcon');
      let toastTimeout;

      // Settings modal
      const settingsModal = document.getElementById('settingsModal');
      const settingsBtn = document.getElementById('settingsBtn');
      const closeSettingsBtn = document.getElementById('closeSettingsBtn');

      const invList = document.getElementById('invList');
      const newInvName = document.getElementById('newInvName');
      const addInvBtn = document.getElementById('addInvBtn');
      const resetRulesBtn = document.getElementById('resetRulesBtn');

      const linkName = document.getElementById('linkName');
      const linkUrl = document.getElementById('linkUrl');
      const addLinkBtn = document.getElementById('addLinkBtn');
      const linksList = document.getElementById('linksList');
      const maxLinksInput = document.getElementById('maxLinksInput');
      const saveMaxLinksBtn = document.getElementById('saveMaxLinksBtn');

      const toggleSnow = document.getElementById('toggleSnow');
      const toggleSmart = document.getElementById('toggleSmart');
      const toggleFeed = document.getElementById('toggleFeed');
      const saveSettingsBtn = document.getElementById('saveSettingsBtn');
      const resetAllBtn = document.getElementById('resetAllBtn');

      // ===== Helpers =====
      function safeJsonParse(value, fallback) { try { return JSON.parse(value); } catch { return fallback; } }
      function flash(el){ if(!el) return; el.classList.remove('flash'); void el.offsetWidth; el.classList.add('flash'); setTimeout(()=>el.classList.remove('flash'), 260); }

      function showToast(message, type = 'info') {
        toastMsg.textContent = message;

        toast.className =
          "fixed bottom-5 left-5 px-5 py-3 rounded-2xl shadow-2xl transform transition-all duration-300 z-[70] flex items-center gap-3 font-bold border";

        if (type === 'success') {
          toast.classList.add('bg-emerald-950/80', 'border-emerald-800/60', 'text-emerald-100');
          toastIcon.className = "fa-solid fa-circle-check text-emerald-300";
        } else if (type === 'error') {
          toast.classList.add('bg-red-950/80', 'border-red-800/60', 'text-red-100');
          toastIcon.className = "fa-solid fa-triangle-exclamation text-red-300";
        } else if (type === 'copy') {
          toast.classList.add('bg-blue-950/80', 'border-blue-800/60', 'text-blue-100');
          toastIcon.className = "fa-solid fa-copy text-blue-300";
        } else {
          toast.classList.add('bg-slate-900/90', 'border-slate-700/70', 'text-white');
          toastIcon.className = "fa-solid fa-info-circle text-slate-200";
        }

        toast.classList.remove('translate-y-20', 'opacity-0');
        clearTimeout(toastTimeout);
        toastTimeout = setTimeout(() => toast.classList.add('translate-y-20', 'opacity-0'), 2300);
      }

      async function copyText(text) {
        try {
          if (navigator.clipboard && window.isSecureContext) {
            await navigator.clipboard.writeText(text);
            return true;
          }
        } catch (_) {}

        try {
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.style.position = 'fixed';
          ta.style.top = '-9999px';
          ta.style.left = '-9999px';
          document.body.appendChild(ta);
          ta.focus();
          ta.select();
          const ok = document.execCommand('copy');
          document.body.removeChild(ta);
          return ok;
        } catch (_) {
          return false;
        }
      }

      // ===== Config (inventories + links + toggles) =====
      const CONFIG_KEY = 'smartInventory_config_v1_user';
      const defaultConfig = {
        inventories: [
          { id:'main', name:'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', locked:true },
          { id:'gemini', name:'Gemini', locked:false },
          { id:'go', name:'Go', locked:false } // UI label will be ChatGPT
        ],
        // rules exactly as you asked:
        // main: to Gemini + Go
        // Go: to main or Gemini
        // Gemini: to Go
        moveRules: { main:['gemini','go'], go:['main','gemini'], gemini:['go'] },
        links: [],
        maxLinks: 5,
        ui: { snow:true, smart:true, feed:true }
      };

      let config = loadConfig();
      function loadConfig(){
        const v = localStorage.getItem(CONFIG_KEY);
        if(!v) return structuredClone(defaultConfig);
        const c = safeJsonParse(v, null);
        if(!c) return structuredClone(defaultConfig);
        const merged = structuredClone(defaultConfig);
        Object.assign(merged, c);
        merged.ui = Object.assign(structuredClone(defaultConfig.ui), c.ui || {});
        merged.links = Array.isArray(c.links) ? c.links : [];
        merged.inventories = Array.isArray(c.inventories) && c.inventories.length ? c.inventories : structuredClone(defaultConfig.inventories);
        merged.moveRules = Object.assign(structuredClone(defaultConfig.moveRules), c.moveRules || {});
        merged.maxLinks = Number.isFinite(c.maxLinks) ? c.maxLinks : defaultConfig.maxLinks;
        return merged;
      }
      function saveConfig(){ localStorage.setItem(CONFIG_KEY, JSON.stringify(config)); }

      function invName(invId){
        const inv = (config.inventories||[]).find(x=>x.id===invId);
        if(!inv) return invId;
        // Special: Go shown as ChatGPT
        if(inv.id === 'go') return 'ChatGPT';
        return inv.name;
      }
      function serviceLabel(invId){
        // service label above Email/Pass
        if(invId === 'go') return 'ChatGPT Ø³Ù†ÙˆÙŠ';
        if(invId === 'gemini') return 'Gemini Ø³Ù†ÙˆÙŠ';
        if(invId === 'main') return 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø³Ù†ÙˆÙŠ';
        return `${invName(invId)} Ø³Ù†ÙˆÙŠ`;
      }

      // ===== Storage per inventory =====
      function keysFor(invId){
        const p = `smart_${invId}_`;
        return { data:p+'data', pulled:p+'pulled', last:p+'last', undo:p+'undo' };
      }

      const store = {}; // invId -> {inventory,pulledCounter,currentAccount}
      function ensureStore(invId){
        if(!store[invId]) store[invId] = { inventory: [], pulledCounter: 0, currentAccount: null };
        return store[invId];
      }

      function loadInv(invId){
        const s = ensureStore(invId);
        const k = keysFor(invId);
        s.inventory = safeJsonParse(localStorage.getItem(k.data), []);
        s.pulledCounter = Number(localStorage.getItem(k.pulled) || 0) || 0;
        const last = safeJsonParse(localStorage.getItem(k.last), null);
        if(last) s.currentAccount = last;
      }

      function saveInv(invId){
        const s = ensureStore(invId);
        const k = keysFor(invId);
        localStorage.setItem(k.data, JSON.stringify(s.inventory));
        localStorage.setItem(k.pulled, String(s.pulledCounter));
        if(s.currentAccount) localStorage.setItem(k.last, JSON.stringify(s.currentAccount));
      }

      function setUndo(invId, obj){
        localStorage.setItem(keysFor(invId).undo, JSON.stringify(obj || null));
      }
      function getUndo(invId){
        return safeJsonParse(localStorage.getItem(keysFor(invId).undo), null);
      }
      function clearLast(invId){
        localStorage.removeItem(keysFor(invId).last);
      }

      // ===== Active tab =====
      let activeInvId = 'main';

      // ===== UI Update =====
      function setStockCounterColor(stockLen) {
        if (stockLen === 0) stockCountEl.className = "text-2xl font-extrabold text-red-400";
        else if (stockLen < 5) stockCountEl.className = "text-2xl font-extrabold text-amber-300";
        else stockCountEl.className = "text-2xl font-extrabold text-emerald-300";
      }

      function applySearch(list){
        const q = (searchInputEl.value || '').trim().toLowerCase();
        if(!q) return list;
        return list.filter(a => String(a.email || '').toLowerCase().includes(q));
      }

      function displayResult(acc){
        if(!acc) return;
        resultAreaEl.classList.remove('hidden');
        emailDisplayEl.textContent = acc.email || '---';
        passDisplayEl.textContent  = acc.password || '---';
        recDisplayEl.textContent   = acc.recovery || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
        urlBtnEl.href = acc.url && acc.url !== '' ? acc.url : '#';
        const now = new Date();
        timestampEl.textContent = now.toLocaleTimeString('ar-IQ', { hour:'2-digit', minute:'2-digit', second:'2-digit' });
      }

      function updateTitle(){
        // Fix: main should be "Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ" (no Ø§Ù„Ù€...)
        if(activeInvId === 'main') titleNameEl.textContent = 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ';
        else titleNameEl.textContent = `Ù…Ø®Ø²ÙˆÙ† ${invName(activeInvId)}`;
      }

      function updateSmartSummary(){
        const s = ensureStore(activeInvId);
        const list = applySearch(s.inventory);
        const last = s.currentAccount;

        function strength(p){
          if(!p) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
          let score = 0;
          if(p.length >= 10) score++;
          if(/[A-Z]/.test(p)) score++;
          if(/[0-9]/.test(p)) score++;
          if(/[^A-Za-z0-9]/.test(p)) score++;
          if(score <= 1) return 'Ø¶Ø¹ÙŠÙ';
          if(score === 2) return 'Ù…ØªÙˆØ³Ø·';
          return 'Ù‚ÙˆÙŠ';
        }

        const tabName = (activeInvId === 'main') ? 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ' : invName(activeInvId);
        const now = new Date().toLocaleDateString('ar-IQ');

        smartSummary.textContent =
          `Ø§Ù„ØªØ¨ÙˆÙŠØ¨: ${tabName} â€” Ø§Ù„ØªØ§Ø±ÙŠØ®: ${now} â€” Ø§Ù„Ù…ØªØ§Ø­ (Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«): ${list.length} â€” `
          + `Ø§Ù„Ù…Ø³Ø­ÙˆØ¨: ${s.pulledCounter} â€” `
          + (last ? `Ø¢Ø®Ø± Ø­Ø³Ø§Ø¨: ${last.email} (Ù‚ÙˆØ© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯: ${strength(last.password)})` : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨ Ø­Ø§Ù„ÙŠØ§Ù‹');
      }

      function renderTabs(){
        tabsWrap.innerHTML = '';
        for(const inv of config.inventories){
          const btn = document.createElement('button');
          btn.className = `press-glow soft tab-pill px-4 py-2 rounded-2xl text-sm font-bold text-slate-100 ${inv.id === activeInvId ? 'tab-active' : ''}`;
          const icon =
            inv.id === 'main' ? 'fa-layer-group text-blue-300' :
            inv.id === 'gemini' ? 'fa-wand-magic-sparkles text-purple-300' :
            inv.id === 'go' ? 'fa-robot text-emerald-300' :
            'fa-layer-group text-amber-300';
          btn.innerHTML = `<i class="fa-solid ${icon} ml-2"></i>${invName(inv.id)}`;
          btn.addEventListener('click', ()=> setActive(inv.id));
          tabsWrap.appendChild(btn);
        }
      }

      function renderMoveButtons(){
        moveTargetsEl.innerHTML = '';
        moveTargetsEl.classList.add('hidden');

        const rules = config.moveRules || {};
        const targets = Array.isArray(rules[activeInvId]) ? rules[activeInvId] : [];
        const validTargets = targets.filter(t => t !== activeInvId && config.inventories.some(i=>i.id===t));

        if(!validTargets.length){
          moveBtn.style.opacity = '0.5';
          moveBtn.style.pointerEvents = 'none';
          return;
        }
        moveBtn.style.opacity = '1';
        moveBtn.style.pointerEvents = '';

        for(const t of validTargets){
          const b = document.createElement('button');
          b.className = "press-glow soft bg-purple-700/18 hover:bg-purple-700/25 border border-purple-700/25 text-purple-100 font-bold py-2 px-4 rounded-2xl text-sm";
          const label =
            (activeInvId === 'go' && t === 'main') ? 'Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠ' :
            `Ù†Ù‚Ù„ Ø¥Ù„Ù‰ ${invName(t)}`;
          b.textContent = label;
          b.addEventListener('click', ()=> moveCurrentTo(t));
          moveTargetsEl.appendChild(b);
        }
      }

      function updateUI(){
        const s = ensureStore(activeInvId);
        const filtered = applySearch(s.inventory);
        stockCountEl.textContent = filtered.length;
        pulledCountEl.textContent = s.pulledCounter;
        setStockCounterColor(filtered.length);

        updateTitle();
        renderTabs();
        renderMoveButtons();

        if(config.ui.smart) updateSmartSummary();

        if(s.currentAccount) displayResult(s.currentAccount);
        else resultAreaEl.classList.add('hidden');
      }

      function setActive(invId){
        activeInvId = invId;
        if(!store[invId]) loadInv(invId);
        updateUI();
        showToast(`ØªÙ… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰: ${invName(invId)}`, 'info');
      }

      // ===== Parsing + Add =====
      function parseStandardLine(line){
        const parts = line.split(';').map(p=>p.trim());
        if(parts.length < 2) return null;
        const email = parts[0], password = parts[1];
        const recovery = parts[2] || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
        const url = parts[3] || '#';
        if(!email || !password) return null;
        if(!email.includes('@')) return null; // IMPORTANT: reject non-email (header etc)
        return { email, password, recovery, url };
      }

      function parseQuickLine(line){
        const m = line.match(/^([^\s@]+@[^\s@]+\.[^\s@]+)(.+)$/);
        if(!m) return null;
        const email = (m[1]||'').trim();
        const password = (m[2]||'').trim();
        if(!email || !password) return null;
        return { email, password, recovery:'ØºÙŠØ± Ù…ØªÙˆÙØ±', url:'#' };
      }

      function addTextToStock(text){
        const s = ensureStore(activeInvId);

        text = String(text||'').replace(/\u0000/g,'').replace(/^\uFEFF/, '');

        const lines = text
          .replace(/\r/g,'')
          .split('\n')
          .map(x=>x.trim())
          .filter(Boolean);

        let added=0, dup=0, bad=0, header=0;

        const existsEmail = (email) => s.inventory.some(a => a.email === email);

        for(const raw of lines){
          const line = raw.trim();

          // ignore common headers
          const low = line.toLowerCase();
          if(line.startsWith('{') || low.includes('{login}') || low.includes('login};{password') || low.includes('email;pass;') || low.includes('email;password')){
            header++; continue;
          }

          let acc = null;

          if(line.includes(';')) acc = parseStandardLine(line);
          else if(line.includes(',')) acc = parseStandardLine(line.replace(/,/g,';'));
          else acc = parseQuickLine(line);

          if(!acc){ bad++; continue; }
          if(existsEmail(acc.email)){ dup++; continue; }
          s.inventory.push(acc);
          added++;
        }

        saveInv(activeInvId);
        updateUI();

        if(added === 0 && (bad > 0 || header > 0)){
          showToast(`Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø´ÙŠØ¡. (Ù‡ÙŠØ¯Ø±: ${header} | ØºÙŠØ± ØµØ§Ù„Ø­: ${bad})`, 'error');
        }else{
          let msg = `ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${added} Ø­Ø³Ø§Ø¨`;
          if(header) msg += ` (ØªØ¬Ø§Ù‡Ù„ Ù‡ÙŠØ¯Ø±: ${header})`;
          if(dup) msg += ` (Ù…ÙƒØ±Ø±: ${dup})`;
          if(bad) msg += ` (ØºÙŠØ± ØµØ§Ù„Ø­: ${bad})`;
          showToast(msg, added ? 'success' : 'error');
        }
      }

      function addToStock(){
        flash(addBtn);
        const standard = bulkInputEl.value || '';
        const quick = quickInputEl.value || '';
        if(!standard.trim() && !quick.trim()){
          showToast('Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙØ§Ø±ØºØ©!', 'error');
          return;
        }
        addTextToStock((standard ? standard + '\n' : '') + (quick ? quick + '\n' : ''));
        bulkInputEl.value = '';
        quickInputEl.value = '';
      }

      // ===== Pull + Undo =====
      function pullAccount(){
        flash(pullBtn);
        const s = ensureStore(activeInvId);
        const filtered = applySearch(s.inventory);
        if(filtered.length === 0){
          showToast('Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙØ§Ø±Øº (Ø£Ùˆ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø¨Ø­Ø«).', 'error');
          return;
        }

        let idx = 0;
        if((searchInputEl.value||'').trim()){
          const firstEmail = filtered[0].email;
          idx = s.inventory.findIndex(a => a.email === firstEmail);
          if(idx < 0) idx = 0;
        }

        const acc = s.inventory.splice(idx,1)[0];
        s.currentAccount = acc;
        s.pulledCounter++;

        setUndo(activeInvId, { acc, idx, time: Date.now() });
        saveInv(activeInvId);

        displayResult(acc);
        updateUI();
        showToast('ØªÙ… Ø³Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
      }

      function undoLastPull(){
        flash(undoPullBtn);
        const u = getUndo(activeInvId);
        if(!u || !u.acc){
          showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ© Ø³Ø­Ø¨ Ù„Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§.', 'error');
          return;
        }
        const s = ensureStore(activeInvId);

        const idx = Number.isFinite(u.idx) ? Math.max(0, Math.min(u.idx, s.inventory.length)) : 0;
        if(!s.inventory.some(a => a.email === u.acc.email)){
          s.inventory.splice(idx, 0, u.acc);
        }
        if(s.pulledCounter > 0) s.pulledCounter--;

        s.currentAccount = null;
        clearLast(activeInvId);
        setUndo(activeInvId, null);

        saveInv(activeInvId);
        updateUI();
        showToast('ØªÙ… Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø¢Ø®Ø± Ø³Ø­Ø¨', 'success');
      }

      // ===== Clear =====
      function clearStorage(){
        flash(clearBtn);
        if(!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù…Ø®Ø²ÙˆÙ† (${invName(activeInvId)}) Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ`)) return;

        const s = ensureStore(activeInvId);
        s.inventory = [];
        s.pulledCounter = 0;
        s.currentAccount = null;

        const k = keysFor(activeInvId);
        localStorage.removeItem(k.data);
        localStorage.removeItem(k.pulled);
        localStorage.removeItem(k.last);
        localStorage.removeItem(k.undo);

        updateUI();
        showToast('ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', 'success');
      }

      // ===== Copy =====
      async function copyField(type){
        const s = ensureStore(activeInvId);
        const acc = s.currentAccount;
        if(!acc){
          showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨ Ù„Ù„Ù†Ø³Ø®.', 'error');
          return;
        }

        let text='', label='';
        if(type === 'email'){ text = acc.email; label='Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„'; }
        else if(type === 'password'){ text = acc.password; label='Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯'; }
        else { text = acc.recovery; label='Ø§Ù„ØªØ­Ù‚Ù‚'; }

        const ok = await copyText(String(text||''));
        showToast(ok ? `ØªÙ… Ù†Ø³Ø® ${label}` : 'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® (Ø¬Ø±Ù‘Ø¨ HTTPS Ø£Ùˆ localhost)', ok ? 'copy' : 'error');
      }

      async function copyFullCombo(){
        flash(copyFullBtn);
        const s = ensureStore(activeInvId);
        const acc = s.currentAccount;
        if(!acc){
          showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨ Ù„Ù†Ø³Ø® Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª.', 'error');
          return;
        }
        const textToCopy =
          `Ø§Ù„Ø§ÙŠÙ…ÙŠÙ„: ${acc.email}\n` +
          `Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯: ${acc.password}\n` +
          `Ø§Ù„ØªØ­Ù‚Ù‚: ${acc.recovery}\n` +
          `Ø±Ø§Ø¨Ø· Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${acc.url || "#"}`;
        const ok = await copyText(textToCopy);
        showToast(ok ? 'ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙƒØ§Ù…Ù„Ø©' : 'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®', ok ? 'success' : 'error');
      }

      async function copyEmailPassPretty(){
        flash(copyEPBtn);
        const s = ensureStore(activeInvId);
        const acc = s.currentAccount;
        if(!acc){
          showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨.', 'error');
          return;
        }
        const text =
          `${serviceLabel(activeInvId)}\n\n` +
          `Ø§Ù„Ø§ÙŠÙ…ÙŠÙ„: ${acc.email}\n` +
          `Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯: ${acc.password}\n`;
        const ok = await copyText(text);
        showToast(ok ? 'ØªÙ… Ù†Ø³Ø® Email + Pass' : 'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®', ok ? 'copy' : 'error');
      }

      async function copyCompact(){
        flash(copyCompactBtn);
        const s = ensureStore(activeInvId);
        const acc = s.currentAccount;
        if(!acc){
          showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨.', 'error');
          return;
        }
        const line = `${acc.email};${acc.password};${acc.recovery || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'};${acc.url || '#'}`;
        const ok = await copyText(line);
        showToast(ok ? 'ØªÙ… Ù†Ø³Ø® Ø¢Ø®Ø± Ø­Ø³Ø§Ø¨ (Ø³Ø·Ø± ÙˆØ§Ø­Ø¯)' : 'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®', ok ? 'copy' : 'error');
      }

      function deleteLastPulled(){
        flash(deleteLastBtn);
        const s = ensureStore(activeInvId);
        if(!s.currentAccount){
          showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨.', 'error');
          return;
        }
        s.currentAccount = null;
        clearLast(activeInvId);
        saveInv(activeInvId);
        resultAreaEl.classList.add('hidden');
        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©', 'success');
      }

      function restoreLastPulled(){
        flash(restoreBtn);
        const s = ensureStore(activeInvId);
        const acc = s.currentAccount;
        if(!acc){
          showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨ Ù„Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹.', 'error');
          return;
        }
        if(!s.inventory.some(a=>a.email === acc.email)){
          s.inventory.unshift(acc);
        }
        if(s.pulledCounter > 0) s.pulledCounter--;
        s.currentAccount = null;
        clearLast(activeInvId);
        saveInv(activeInvId);
        updateUI();
        showToast('ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', 'success');
      }

      // ===== Move between inventories (rules-driven) =====
      function moveCurrentTo(targetInvId){
        const sFrom = ensureStore(activeInvId);
        const acc = sFrom.currentAccount;
        if(!acc){
          showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨ Ù„Ù„Ù†Ù‚Ù„.', 'error');
          return;
        }

        // validate rule
        const allowed = (config.moveRules && Array.isArray(config.moveRules[activeInvId])) ? config.moveRules[activeInvId] : [];
        if(!allowed.includes(targetInvId)){
          showToast('Ø§Ù„Ù†Ù‚Ù„ ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø­Ø³Ø¨ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯.', 'error');
          return;
        }

        loadInv(targetInvId);
        const sTo = ensureStore(targetInvId);

        if(sTo.inventory.some(a=>a.email === acc.email)){
          showToast(`Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ ${invName(targetInvId)}.`, 'error');
          return;
        }

        sTo.inventory.unshift(acc);
        saveInv(targetInvId);

        // remove from screen in source (real move)
        sFrom.currentAccount = null;
        clearLast(activeInvId);
        saveInv(activeInvId);

        updateUI();
        showToast(`ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¥Ù„Ù‰ ${invName(targetInvId)}`, 'success');
      }

      // ===== Import TXT (Ultra robust) =====
      function readFileAsTextUltra(file){
        return new Promise((resolve, reject) => {
          try{
            const fr = new FileReader();
            fr.onerror = () => reject(fr.error || new Error('FileReader error'));
            fr.onload = () => {
              try{
                const buf = fr.result;
                const u8 = new Uint8Array(buf);

                const decodeTry = (enc) => {
                  try{
                    if(typeof TextDecoder === 'undefined') return null;
                    return new TextDecoder(enc, { fatal:false }).decode(u8);
                  }catch(_){ return null; }
                };

                const tries = [
                  decodeTry('utf-8'),
                  decodeTry('utf-16le'),
                  decodeTry('utf-16be'),
                  decodeTry('windows-1256'),
                  decodeTry('iso-8859-1'),
                ].filter(x => x !== null);

                const score = (s) => {
                  if(!s) return -999;
                  s = String(s);
                  const nulls = (s.match(/\u0000/g) || []).length;
                  const rep   = (s.match(/\uFFFD/g) || []).length;
                  return (s.trim().length) - (nulls*10) - (rep*2);
                };

                let best = '';
                let bestScore = -999999;
                for(const t of tries){
                  const sc = score(t);
                  if(sc > bestScore){ bestScore = sc; best = t; }
                }

                if(!best || !best.trim()){
                  let s = '';
                  for(let i=0;i<u8.length;i++) s += String.fromCharCode(u8[i]);
                  best = s;
                }

                best = String(best||'').replace(/\u0000/g,'').replace(/^\uFEFF/,'');
                resolve(best);
              }catch(e){ reject(e); }
            };
            fr.readAsArrayBuffer(file);
          }catch(e){ reject(e); }
        });
      }

      async function importTxtFile(file){
        if(!file){ showToast('Ù…Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù.', 'error'); return; }
        flash(importBtn);

        if(file.size === 0){ showToast('Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº.', 'error'); return; }

        try{
          const content = await readFileAsTextUltra(file);
          if(!content || !content.trim()){
            showToast('ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„ÙƒÙ† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙØ§Ø±Øº.', 'error');
            return;
          }
          addTextToStock(content);
        }catch(e){
          console.error(e);
          showToast('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­.', 'error');
        }
      }

      function exportStockToTxt(){
        flash(exportBtn);
        const s = ensureStore(activeInvId);
        const list = applySearch(s.inventory);

        if(!list.length){
          showToast('Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙØ§Ø±Øº (Ø£Ùˆ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø¨Ø­Ø«).', 'error');
          return;
        }

        const content = list.map(acc => `${acc.email};${acc.password};${acc.recovery};${acc.url}`).join('\n');
        const blob = new Blob([content], { type:'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = `${activeInvId}_${new Date().toISOString().slice(0,10)}.txt`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);

        showToast(`ØªÙ… ØªØµØ¯ÙŠØ± ${list.length} Ø­Ø³Ø§Ø¨`, 'success');
      }

      // ===== Smart panel toggle =====
      function toggleSmartPanel(){
        flash(smartStatsBtn);
        smartPanel.classList.toggle('hidden');
        updateSmartSummary();
      }

      // ===== Settings: Links =====
      function renderHomeLinks(){
        const links = config.links || [];
        homeLinksEl.innerHTML = '';
        if(!links.length){ homeLinksEl.classList.add('hidden'); return; }
        homeLinksEl.classList.remove('hidden');

        links.forEach(l=>{
          const a = document.createElement('a');
          a.href = l.url;
          a.target = "_blank";
          a.rel = "noopener";
          a.className = "press-glow soft tab-pill px-3 py-2 rounded-2xl text-sm font-bold text-slate-100 break-any";
          a.textContent = l.name;
          homeLinksEl.appendChild(a);
        });
      }

      function renderLinksList(){
        linksList.innerHTML = '';
        const links = config.links || [];
        if(!links.length){
          const empty = document.createElement('div');
          empty.className = "text-[12px] glow-text";
          empty.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ø­Ø§Ù„ÙŠØ§Ù‹.";
          linksList.appendChild(empty);
          return;
        }
        links.forEach((l, idx)=>{
          const row = document.createElement('div');
          row.className = "flex items-center justify-between gap-2 bg-slate-950/20 border border-slate-700/40 rounded-2xl px-3 py-2";
          row.innerHTML = `
            <div class="min-w-0 break-any">
              <div class="font-bold text-white text-sm">${l.name}</div>
              <div class="text-[11px] text-slate-400">${l.url}</div>
            </div>
            <button class="press-glow soft bg-red-700/18 hover:bg-red-700/25 border border-red-700/25 text-red-100 font-bold px-3 py-2 rounded-2xl text-xs" data-del-link="${idx}">Ø­Ø°Ù</button>
          `;
          linksList.appendChild(row);
        });

        linksList.querySelectorAll('[data-del-link]').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const i = Number(btn.getAttribute('data-del-link'));
            config.links.splice(i,1);
            saveConfig();
            renderLinksList();
            renderHomeLinks();
            showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø§Ø¨Ø·', 'success');
          });
        });
      }

      function addLink(){
        flash(addLinkBtn);
        const name = (linkName.value||'').trim();
        const url = (linkUrl.value||'').trim();
        const max = Math.max(0, Math.floor(Number(config.maxLinks||0)));

        if(!name || !url){ showToast('Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ø§Ø¨Ø·', 'error'); return; }
        if(max === 0){ showToast('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ø­Ø§Ù„ÙŠØ§Ù‹ 0. ØºÙŠÙ‘Ø±Ù‡ Ø£ÙˆÙ„Ø§Ù‹.', 'error'); return; }
        if((config.links||[]).length >= max){ showToast(`ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ (${max}).`, 'error'); return; }
        try{ new URL(url); } catch { showToast('Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­', 'error'); return; }

        config.links.push({ name, url });
        linkName.value = '';
        linkUrl.value = '';
        saveConfig();
        renderLinksList();
        renderHomeLinks();
        showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø§Ø¨Ø·', 'success');
      }

      function saveMaxLinks(){
        flash(saveMaxLinksBtn);
        const n = Math.max(0, Math.floor(Number(maxLinksInput.value||0)));
        config.maxLinks = n;
        if((config.links||[]).length > n) config.links = config.links.slice(0, n);
        saveConfig();
        renderLinksList();
        renderHomeLinks();
        showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø¯', 'success');
      }

      // ===== Settings: Inventories =====
      function slugifyId(name){
        const base = (name||'').toLowerCase().trim()
          .replace(/[\u0600-\u06FF]/g, '')
          .replace(/[^a-z0-9]+/g, '-')
          .replace(/^-+|-+$/g, '');
        return base || ('inv-' + Math.random().toString(16).slice(2,8));
      }

      function renderInvList(){
        invList.innerHTML = '';
        for(const inv of config.inventories){
          const row = document.createElement('div');
          row.className = "flex items-center justify-between gap-2 bg-slate-950/20 border border-slate-700/40 rounded-2xl px-3 py-2";
          row.innerHTML = `
            <div class="min-w-0 break-any">
              <div class="font-bold text-white text-sm">${inv.id === 'go' ? 'Go (ÙŠØ¸Ù‡Ø±: ChatGPT)' : inv.name}</div>
              <div class="text-[11px] text-slate-400 font-mono">id: ${inv.id}</div>
            </div>
            <div class="flex gap-2 shrink-0">
              ${inv.locked ? `<span class="text-[11px] glow-text">Ø±Ø¦ÙŠØ³ÙŠ</span>` : `
                <button class="press-glow soft bg-red-700/18 hover:bg-red-700/25 border border-red-700/25 text-red-100 font-bold px-3 py-2 rounded-2xl text-xs" data-remove="${inv.id}">Ø­Ø°Ù</button>
              `}
            </div>
          `;
          invList.appendChild(row);
        }

        invList.querySelectorAll('[data-remove]').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const id = btn.getAttribute('data-remove');
            removeInventory(id);
          });
        });
      }

      function addInventory(){
        flash(addInvBtn);
        const name = (newInvName.value||'').trim();
        if(!name){ showToast('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', 'error'); return; }
        if(name.length > 18){ showToast('Ø§Ù„Ø§Ø³Ù… Ø·ÙˆÙŠÙ„ØŒ Ø®Ù„ÙŠ Ø£Ù‚ØµØ±', 'error'); return; }

        const id = slugifyId(name);
        if(config.inventories.some(x=>x.id===id)){
          showToast('Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù…/Ø§Ù„Ù…Ø¹Ø±Ù Ù…ÙˆØ¬ÙˆØ¯. ØºÙŠÙ‘Ø± Ø§Ù„Ø§Ø³Ù….', 'error');
          return;
        }

        config.inventories.push({ id, name, locked:false });

        // Default rule for new inventory:
        // you asked: any inventory added should follow same copy format.
        // For move rules, we make it able to move to "go" if exists, else to main.
        const hasGo = config.inventories.some(x=>x.id==='go');
        config.moveRules[id] = hasGo ? ['go'] : ['main'];

        saveConfig();
        newInvName.value = '';
        loadInv(id);
        renderTabs();
        renderInvList();
        renderMoveButtons();
        showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø²ÙˆÙ† Ø¬Ø¯ÙŠØ¯', 'success');
      }

      function removeInventory(invId){
        const inv = config.inventories.find(x=>x.id===invId);
        if(!inv || inv.locked) return;
        if(!confirm(`Ø­Ø°Ù Ù…Ø®Ø²ÙˆÙ† (${invName(invId)})ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ Ø£ÙŠØ¶Ø§Ù‹.`)) return;

        // remove from config
        config.inventories = config.inventories.filter(x=>x.id!==invId);
        // remove from rules
        for(const k in (config.moveRules||{})){
          config.moveRules[k] = (config.moveRules[k]||[]).filter(x=>x!==invId);
        }
        delete config.moveRules[invId];

        // remove local storage
        const k = keysFor(invId);
        localStorage.removeItem(k.data);
        localStorage.removeItem(k.pulled);
        localStorage.removeItem(k.last);
        localStorage.removeItem(k.undo);

        if(activeInvId === invId) activeInvId = 'main';

        saveConfig();
        renderTabs();
        renderInvList();
        setActive(activeInvId);
        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', 'success');
      }

      function resetMoveRules(){
        flash(resetRulesBtn);
        config.moveRules = structuredClone(defaultConfig.moveRules);
        saveConfig();
        renderInvList();
        renderMoveButtons();
        showToast('ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù†Ù‚Ù„', 'success');
      }

      // ===== Settings: UI toggles =====
      function applyUiToggles(){
        document.getElementById('snowCanvas').style.display = config.ui.snow ? '' : 'none';
        smartStatsBtn.style.display = config.ui.smart ? '' : 'none';
        if(!config.ui.smart) smartPanel.classList.add('hidden');
        document.querySelector('section.glass-panel.soft.p-4.rounded-3xl.shadow-xl')?.style.setProperty('display', config.ui.smart ? '' : 'none');
        // feed panel: hide inputs section by hiding entire section if off
        // (keep safe if query changes)
        const feedSection = inputSectionEl?.closest('section');
        if(feedSection) feedSection.style.display = config.ui.feed ? '' : 'none';
      }

      function saveUiSettings(){
        flash(saveSettingsBtn);
        config.ui.snow = !!toggleSnow.checked;
        config.ui.smart = !!toggleSmart.checked;
        config.ui.feed = !!toggleFeed.checked;
        saveConfig();
        applyUiToggles();
        updateUI();
        showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'success');
      }

      function resetAll(){
        flash(resetAllBtn);
        if(!confirm('ØªØµÙÙŠØ± ÙƒÙ„ Ø´ÙŠØ¡ØŸ (ÙƒÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†Ø§Øª + Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)')) return;

        // wipe inventory storages for all invs (current config list + default list)
        const ids = new Set([...(config.inventories||[]).map(x=>x.id), ...(defaultConfig.inventories||[]).map(x=>x.id)]);
        ids.forEach(id=>{
          const k = keysFor(id);
          localStorage.removeItem(k.data);
          localStorage.removeItem(k.pulled);
          localStorage.removeItem(k.last);
          localStorage.removeItem(k.undo);
        });

        localStorage.removeItem(CONFIG_KEY);

        config = loadConfig();
        activeInvId = 'main';

        // reset store cache
        for(const k in store) delete store[k];

        loadAllInventories();
        renderTabs();
        renderHomeLinks();
        applyUiToggles();
        setActive('main');
        showToast('ØªÙ… Ø§Ù„ØªØµÙÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„', 'success');
      }

      // ===== Settings modal open/close =====
      function openSettings(){
        flash(settingsBtn);
        renderSettings();
        settingsModal.classList.add('open');
        document.body.style.overflow = 'hidden';
      }
      function closeSettings(){
        flash(closeSettingsBtn);
        settingsModal.classList.remove('open');
        document.body.style.overflow = '';
      }

      function renderSettings(){
        renderInvList();
        renderLinksList();
        maxLinksInput.value = String(config.maxLinks ?? 5);

        toggleSnow.checked = !!config.ui.snow;
        toggleSmart.checked = !!config.ui.smart;
        toggleFeed.checked = !!config.ui.feed;
      }

      // ===== Events =====
      toggleBtn.addEventListener('click', () => { flash(toggleBtn); inputSectionEl.classList.toggle('hidden'); });
      clearBtn.addEventListener('click', clearStorage);
      addBtn.addEventListener('click', addToStock);
      pullBtn.addEventListener('click', pullAccount);

      smartStatsBtn.addEventListener('click', toggleSmartPanel);
      clearSearchBtn.addEventListener('click', () => { flash(clearSearchBtn); searchInputEl.value=''; updateUI(); });
      copyCompactBtn.addEventListener('click', copyCompact);
      undoPullBtn.addEventListener('click', undoLastPull);
      searchInputEl.addEventListener('input', () => updateUI());

      copyFullBtn.addEventListener('click', copyFullCombo);
      copyEPBtn.addEventListener('click', copyEmailPassPretty);

      restoreBtn.addEventListener('click', restoreLastPulled);
      deleteLastBtn.addEventListener('click', deleteLastPulled);

      document.querySelectorAll('[data-copy]').forEach(card => {
        card.addEventListener('click', () => { flash(card); copyField(card.getAttribute('data-copy')); });
      });

      moveBtn.addEventListener('click', ()=>{
        flash(moveBtn);
        moveTargetsEl.classList.toggle('hidden');
      });

      importBtn.addEventListener('click', () => { flash(importBtn); setTimeout(()=>importFile.click(), 0); });
      importFile.addEventListener('change', async () => {
        const file = importFile.files && importFile.files[0] ? importFile.files[0] : null;
        await importTxtFile(file);
        importFile.value = '';
      });

      exportBtn.addEventListener('click', exportStockToTxt);

      // Settings events
      settingsBtn.addEventListener('click', openSettings);
      closeSettingsBtn.addEventListener('click', closeSettings);
      settingsModal.addEventListener('click', (e)=>{ if(e.target === settingsModal) closeSettings(); });

      addInvBtn.addEventListener('click', addInventory);
      resetRulesBtn.addEventListener('click', resetMoveRules);

      addLinkBtn.addEventListener('click', addLink);
      saveMaxLinksBtn.addEventListener('click', saveMaxLinks);

      saveSettingsBtn.addEventListener('click', saveUiSettings);
      resetAllBtn.addEventListener('click', resetAll);

      // ===== Init =====
      function loadAllInventories(){
        for(const inv of config.inventories){
          loadInv(inv.id);
        }
      }

      window.addEventListener('load', () => {
        loadAllInventories();
        renderTabs();
        renderHomeLinks();
        applyUiToggles();
        setActive('main');
      });

      // ===== Snow (Ø®ÙÙŠÙ ÙˆØ´ÙØ§Ù ÙˆØ³Ø±ÙŠØ¹) =====
      const canvas = document.getElementById('snowCanvas');
      const ctx = canvas.getContext('2d', { alpha: true });
      let W = 0, H = 0;

      function resize(){
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
      }
      window.addEventListener('resize', resize, { passive:true });
      resize();

      const flakes = Array.from({ length: 55 }, () => ({
        x: Math.random()*W,
        y: Math.random()*H,
        r: 0.6 + Math.random()*1.6,
        v: 0.25 + Math.random()*0.9,
        drift: (Math.random()*0.6) - 0.3,
        a: 0.12 + Math.random()*0.20
      }));

      function snowTick(){
        if(!config.ui.snow){
          requestAnimationFrame(snowTick);
          return;
        }
        ctx.clearRect(0,0,W,H);
        for(const f of flakes){
          f.y += f.v;
          f.x += f.drift;

          if (f.y > H + 5) { f.y = -5; f.x = Math.random()*W; }
          if (f.x > W + 5) f.x = -5;
          if (f.x < -5) f.x = W + 5;

          ctx.beginPath();
          ctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
          ctx.closePath();
          ctx.fillStyle = `rgba(255,255,255,${f.a})`;
          ctx.fill();
        }
        requestAnimationFrame(snowTick);
      }
      snowTick();

    })();
  </script>
</body>
</html>
