<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø°ÙƒÙŠ | Smart Inventory</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root{ --bg:#0b1224; --panel: rgba(15,23,42,.55); --b: rgba(148,163,184,.18); }
    body{
      font-family:'Tajawal', sans-serif;
      background:
        radial-gradient(900px 500px at 15% -10%, rgba(59,130,246,.18), transparent 60%),
        radial-gradient(800px 500px at 90% 10%, rgba(16,185,129,.12), transparent 55%),
        var(--bg);
      color:#e2e8f0;
      overflow-x:hidden;
    }
    ::-webkit-scrollbar{ width:8px; }
    ::-webkit-scrollbar-track{ background:#070c18; }
    ::-webkit-scrollbar-thumb{ background:#3b82f6; border-radius:6px; }
    ::-webkit-scrollbar-thumb:hover{ background:#2563eb; }

    .glass{ background: var(--panel); border:1px solid var(--b); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
    .soft{ transition: background .16s ease, border-color .16s ease, box-shadow .16s ease, transform .06s ease; }
    .press:active{ box-shadow: 0 0 0 3px rgba(255,255,255,.08), 0 0 18px rgba(59,130,246,.20); transform: translateY(1px); }
    .flash{ animation: flash .22s ease-out; }
    @keyframes flash{ to{ box-shadow: 0 0 0 3px rgba(255,255,255,.08), 0 0 22px rgba(56,189,248,.20); } }

    .glow{ color:#cbd5e1; text-shadow: 0 0 10px rgba(56,189,248,.18), 0 0 22px rgba(16,185,129,.10); }
    .break-any{ word-break: break-word; overflow-wrap:anywhere; }

    #snowCanvas{ position:fixed; inset:0; pointer-events:none; z-index:5; opacity:.55; }

    /* Modal */
    .modal{
      position:fixed; inset:0; background: rgba(0,0,0,.55);
      z-index:60; display:none; padding: calc(12px + env(safe-area-inset-top)) 12px 12px;
      overflow:auto; -webkit-overflow-scrolling:touch;
    }
    .modal.open{ display:flex; align-items:flex-start; justify-content:center; }
    .modal-card{ width:100%; max-width:980px; max-height: calc(100vh - 28px - env(safe-area-inset-top)); overflow:auto; -webkit-overflow-scrolling:touch; }
    .sticky-head{
      position:sticky; top:0; z-index:5;
      background: rgba(15,23,42,.92);
      border-bottom:1px solid var(--b);
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      border-radius:18px; padding:10px 12px; margin-bottom:10px;
    }

    /* file input hidden (still selectable via label) */
    .file-real{
      position: fixed; left: -9999px; top:0; width:1px; height:1px;
      opacity:0; pointer-events:none;
    }
  </style>
</head>

<body class="min-h-screen flex flex-col items-center py-5 px-3">
  <canvas id="snowCanvas"></canvas>

  <!-- Header (âœ… Mobile-first) -->
  <header class="w-full max-w-5xl mb-4 relative z-10">
    <div class="glass soft rounded-3xl p-4">
      <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
        <div class="min-w-0">
          <h1 class="text-2xl md:text-3xl font-extrabold text-blue-400 flex items-center gap-3">
            <i class="fa-solid fa-boxes-stacked"></i>
            <span id="titleName" class="break-any">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</span>
          </h1>
          <p class="text-slate-400 text-sm">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</p>
          <p class="glow text-xs mt-1">
            Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù†Ø³Ø® ÙŠØ¹Ù…Ù„ Ø£ÙØ¶Ù„ Ø¹Ù„Ù‰ HTTPS Ø£Ùˆ localhost â€” ÙˆØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø«Ù‚ÙŠÙ„Ø© Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ù‡Ø§ØªÙ âœ¨
          </p>
        </div>

        <!-- âœ… Mobile layout: full width controls -->
        <div class="w-full md:w-auto flex flex-col gap-3">
          <div class="flex flex-wrap gap-2 items-center justify-between">
            <div id="homeLinks" class="hidden flex-wrap gap-2"></div>
            <button id="settingsBtn" class="press soft glass px-3 py-2 rounded-2xl text-sm font-bold">
              <i class="fa-solid fa-gear ml-2 text-slate-200"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
          </div>

          <div id="tabsWrap" class="flex gap-2 flex-wrap"></div>

          <!-- âœ… Mobile: cards share width -->
          <div class="grid grid-cols-2 gap-2">
            <div class="glass soft px-4 py-3 rounded-2xl text-center">
              <span class="block text-xs text-slate-400">Ø§Ù„Ù…ØªÙˆÙØ±</span>
              <span id="stockCount" class="text-2xl font-extrabold text-emerald-300">0</span>
            </div>
            <div class="glass soft px-4 py-3 rounded-2xl text-center">
              <span class="block text-xs text-slate-400">ØªÙ… Ø³Ø­Ø¨Ù‡Ø§</span>
              <span id="pulledCount" class="text-2xl font-extrabold text-purple-300">0</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="w-full max-w-5xl space-y-4 relative z-10">

    <!-- Smart tools -->
    <section class="glass soft p-4 rounded-3xl">
      <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
        <div class="flex items-center gap-2">
          <i class="fa-solid fa-sparkles text-amber-300"></i>
          <span class="font-extrabold text-white">Ø£Ø¯ÙˆØ§Øª Ø°ÙƒÙŠØ©</span>
          <span class="text-xs glow">Ø¨Ø­Ø« + Ù…Ù„Ø®Øµ + ØªØ±Ø§Ø¬Ø¹</span>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 w-full md:w-auto">
          <div class="relative sm:col-span-1">
            <input id="searchInput" type="text"
              class="w-full bg-slate-950/30 text-sm text-white px-4 py-3 rounded-2xl border border-slate-700/60 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none placeholder-slate-500"
              placeholder="Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„)..." />
            <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
          </div>

          <button id="smartStatsBtn"
            class="press soft bg-slate-800/55 hover:bg-slate-700/60 border border-slate-700/60 text-white font-bold px-4 py-3 rounded-2xl flex items-center justify-center gap-2">
            <i class="fa-solid fa-chart-simple text-emerald-300"></i><span>Ù…Ù„Ø®Øµ</span>
          </button>

          <button id="undoPullBtn"
            class="press soft bg-slate-800/55 hover:bg-slate-700/60 border border-slate-700/60 text-white font-bold px-4 py-3 rounded-2xl flex items-center justify-center gap-2">
            <i class="fa-solid fa-rotate-left text-amber-300"></i><span>ØªØ±Ø§Ø¬Ø¹</span>
          </button>
        </div>
      </div>

      <div id="smartPanel" class="hidden mt-3 bg-slate-950/25 border border-slate-700/40 rounded-2xl p-3">
        <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
          <div class="text-sm text-slate-200 min-w-0">
            <div class="font-bold mb-1">ğŸ“Œ Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
            <div class="text-xs glow break-any" id="smartSummary">---</div>
          </div>
          <div class="flex flex-wrap gap-2">
            <button id="copyCompactBtn" class="press soft bg-indigo-600/70 hover:bg-indigo-600 text-white font-bold px-4 py-2 rounded-2xl flex items-center gap-2">
              <i class="fa-solid fa-clipboard text-indigo-100"></i><span>Ù†Ø³Ø® Ø³Ø·Ø±</span>
            </button>
            <button id="clearSearchBtn" class="press soft bg-slate-800/60 hover:bg-slate-700/60 border border-slate-700/60 text-white font-bold px-4 py-2 rounded-2xl flex items-center gap-2">
              <i class="fa-solid fa-eraser text-slate-200"></i><span>Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«</span>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Feed -->
    <section class="glass soft p-4 rounded-3xl">
      <div class="flex justify-between items-center mb-3 gap-3">
        <h2 class="text-lg md:text-xl font-bold text-white flex items-center gap-2">
          <i class="fa-solid fa-cloud-arrow-up text-blue-400"></i><span>ØªØºØ°ÙŠØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
        </h2>
        <button id="toggleBtn" class="press soft text-slate-300 hover:text-white text-sm underline">Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø±</button>
      </div>

      <div id="inputSection" class="space-y-3">
        <textarea id="bulkInput" rows="4"
          class="w-full bg-slate-950/30 text-sm text-white p-4 rounded-2xl border border-slate-700/60 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none placeholder-slate-500"
          placeholder="email;pass;recovery;url"></textarea>

        <div class="bg-slate-950/15 border border-slate-700/40 rounded-2xl p-3">
          <div class="flex items-center gap-2 mb-2 text-slate-200">
            <i class="fa-solid fa-bolt text-amber-300"></i>
            <span class="font-bold">Ø®Ø§Ù†Ø© Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
          </div>
          <p class="text-xs glow mb-2">ÙƒÙ„ Ø³Ø·Ø±: <span class="font-mono text-slate-200">email@gmail.comPASSWORD</span></p>
          <textarea id="quickInput" rows="2"
            class="w-full bg-slate-950/30 text-sm text-white p-4 rounded-2xl border border-slate-700/60 focus:border-amber-400 focus:ring-2 focus:ring-amber-400/20 outline-none placeholder-slate-500"
            placeholder="oyufezusu066@gmail.comIsbzXRgTi77up"></textarea>
        </div>

        <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
          <button id="clearBtn"
            class="press soft text-red-200 hover:text-red-100 px-4 py-2 rounded-xl border border-red-900/40 bg-red-950/20 hover:bg-red-950/30 w-full md:w-auto">
            <i class="fa-solid fa-trash ml-1"></i> ØªØµÙÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
          </button>

          <!-- âœ… Mobile: buttons grid -->
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 w-full md:w-auto">
            <label for="importFile" id="importBtn"
              class="press soft bg-slate-800/55 hover:bg-slate-700/60 border border-slate-700/60 text-white font-bold py-3 px-4 rounded-2xl flex items-center justify-center gap-2 cursor-pointer select-none">
              <i class="fa-solid fa-file-arrow-up text-blue-300"></i><span>TXT</span>
            </label>
            <input id="importFile" type="file" class="file-real" accept=".txt,text/plain" />

            <button id="exportBtn"
              class="press soft bg-slate-800/55 hover:bg-slate-700/60 border border-slate-700/60 text-white font-bold py-3 px-4 rounded-2xl flex items-center justify-center gap-2">
              <i class="fa-solid fa-file-arrow-down text-emerald-300"></i><span>ØªØµØ¯ÙŠØ± Ø¨Ø­Ø«</span>
            </button>

            <button id="exportRemainingBtn"
              class="press soft bg-emerald-700/18 hover:bg-emerald-700/25 border border-emerald-700/25 text-emerald-100 font-bold py-3 px-4 rounded-2xl flex items-center justify-center gap-2">
              <i class="fa-solid fa-box-open text-emerald-300"></i><span>ØªØµØ¯ÙŠØ± Ø§Ù„ÙƒÙ„</span>
            </button>

            <button id="addBtn"
              class="press soft col-span-2 sm:col-span-1 bg-blue-600 hover:bg-blue-500 text-white font-extrabold py-3 px-4 rounded-2xl flex items-center justify-center gap-2">
              <i class="fa-solid fa-plus"></i><span>Ø¥Ø¶Ø§ÙØ©</span>
            </button>
          </div>
        </div>

        <p class="text-[11px] glow">âœ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙŠØ¯Ø¹Ù… Ù…Ù„ÙØ§Øª Ø¨Ù‡Ø§ Ù‡ÙŠØ¯Ø± {login} ÙˆÙŠØªÙ… ØªØ¬Ø§Ù‡Ù„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</p>
      </div>
    </section>

    <!-- Pull -->
    <div class="flex justify-center">
      <button id="pullBtn"
        class="press soft w-full md:w-auto bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-400 hover:to-teal-500 text-white text-xl font-black py-4 px-6 rounded-3xl shadow-2xl shadow-emerald-500/20">
        <div class="flex items-center justify-center gap-3">
          <i class="fa-solid fa-hand-holding-hand"></i><span>Ø³Ø­Ø¨ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</span>
        </div>
      </button>
    </div>

    <!-- Result -->
    <section id="resultArea" class="hidden">
      <div class="glass soft p-1 rounded-[26px] border border-slate-600/50">
        <div class="bg-slate-950/25 rounded-[22px] p-4">
          <div class="flex flex-col gap-2 md:flex-row md:justify-between md:items-center mb-3 pb-3 border-b border-slate-700/60">
            <span class="text-emerald-300 font-extrabold text-lg flex items-center gap-2">
              <i class="fa-solid fa-check-circle"></i>ØªÙ… Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­
            </span>
            <span class="text-xs text-slate-400 font-mono" id="timestamp"></span>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
            <div class="press soft bg-slate-950/25 p-3 rounded-2xl border border-slate-700/60 group" data-copy="email">
              <label class="text-xs text-slate-400 block mb-1">Email</label>
              <div class="flex justify-between items-center gap-3">
                <span id="emailDisplay" class="font-mono text-blue-300 truncate">---</span>
                <i class="fa-regular fa-copy text-slate-500 group-hover:text-white"></i>
              </div>
            </div>

            <div class="press soft bg-slate-950/25 p-3 rounded-2xl border border-slate-700/60 group" data-copy="password">
              <label class="text-xs text-slate-400 block mb-1">Password</label>
              <div class="flex justify-between items-center gap-3">
                <span id="passDisplay" class="font-mono text-rose-300 truncate">---</span>
                <i class="fa-regular fa-copy text-slate-500 group-hover:text-white"></i>
              </div>
            </div>

            <div class="press soft bg-slate-950/25 p-3 rounded-2xl border border-slate-700/60 group" data-copy="recovery">
              <label class="text-xs text-slate-400 block mb-1">Recovery</label>
              <div class="flex justify-between items-center gap-3">
                <span id="recDisplay" class="font-mono text-amber-300 truncate">---</span>
                <i class="fa-regular fa-copy text-slate-500 group-hover:text-white"></i>
              </div>
            </div>

            <div class="soft bg-slate-950/25 p-3 rounded-2xl border border-slate-700/60 flex justify-between items-center gap-3">
              <div>
                <label class="text-xs text-slate-400 block mb-1">Webhook</label>
                <span class="text-xs glow">Ù„Ù„ÙˆØµÙˆÙ„ Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚</span>
              </div>
              <a id="urlBtn" href="#" target="_blank" rel="noopener"
                 class="press soft bg-indigo-600 hover:bg-indigo-500 text-white text-sm px-4 py-2 rounded-xl">
                <i class="fa-solid fa-arrow-up-right-from-square ml-1"></i> ÙØªØ­
              </a>
            </div>
          </div>

          <div class="space-y-2">
            <button id="copyFullBtn" class="press soft w-full bg-slate-800/55 hover:bg-slate-700/60 border border-slate-700/60 text-white font-bold py-3 rounded-2xl flex items-center justify-center gap-2">
              <i class="fa-solid fa-clipboard-list text-blue-300"></i><span>Ù†Ø³Ø® Ø´Ø§Ù…Ù„</span>
            </button>

            <button id="copyEPBtn" class="press soft w-full bg-blue-700/18 hover:bg-blue-700/25 border border-blue-700/25 text-blue-100 font-bold py-3 rounded-2xl text-sm">
              Ù†Ø³Ø® Email + Pass
            </button>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
              <button id="restoreBtn" class="press soft bg-emerald-700/30 hover:bg-emerald-700/40 border border-emerald-700/35 text-emerald-100 font-bold py-3 rounded-2xl">
                <i class="fa-solid fa-rotate-left text-emerald-300 ml-2"></i>Ø§Ø³ØªØ±Ø¬Ø§Ø¹
              </button>

              <button id="deleteLastBtn" class="press soft bg-red-700/20 hover:bg-red-700/28 border border-red-700/30 text-red-100 font-bold py-3 rounded-2xl">
                <i class="fa-solid fa-xmark text-red-300 ml-2"></i>Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©
              </button>

              <button id="moveBtn" class="press soft bg-purple-700/25 hover:bg-purple-700/35 border border-purple-700/35 text-purple-100 font-bold py-3 rounded-2xl">
                <i class="fa-solid fa-right-left text-purple-300 ml-2"></i>Ù†Ù‚Ù„
              </button>
            </div>

            <div id="moveTargets" class="hidden flex flex-wrap gap-2 pt-1"></div>

            <p class="text-center text-[11px] glow">âœ… Ø¢Ø®Ø± Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨ ÙŠØ¨Ù‚Ù‰ Ù…Ø­ÙÙˆØ¸ Ø­ØªÙ‰ Ù„Ùˆ Ø®Ø±Ø¬Øª ÙˆØ±Ø¬Ø¹Øª Ù„Ø§Ø­Ù‚Ø§Ù‹.</p>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- âœ… Toast (RTL: right) -->
  <div id="toast"
    class="fixed bottom-5 right-5 left-auto bg-slate-900/90 border border-slate-700/70 text-white px-5 py-3 rounded-2xl shadow-2xl transform translate-y-20 opacity-0 transition-all duration-300 z-[70] flex items-center gap-3">
    <i id="toastIcon" class="fa-solid fa-info-circle"></i>
    <span id="toastMsg">ØªÙ… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­</span>
  </div>

  <!-- Settings Modal (ÙƒÙ…Ø§ Ù‡Ùˆ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ Ù„ÙƒÙ† Ø£Ø®Ù) -->
  <div id="settingsModal" class="modal">
    <div class="glass soft modal-card rounded-3xl border border-slate-600/40 p-3">
      <div class="sticky-head">
        <div class="flex items-center justify-between gap-2">
          <div class="flex items-center gap-2 min-w-0">
            <i class="fa-solid fa-gear text-slate-200"></i>
            <span class="font-extrabold text-white">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
            <span class="text-[11px] glow break-any">Ù…Ø®Ø²ÙˆÙ†Ø§Øª + Ø±ÙˆØ§Ø¨Ø· + ØªØ­ÙƒÙ…</span>
          </div>
          <button id="closeSettingsBtn" class="press soft glass px-3 py-2 rounded-2xl text-sm font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-3">
        <div class="bg-slate-950/18 border border-slate-700/35 rounded-2xl p-3">
          <div class="font-extrabold text-white mb-2">
            <i class="fa-solid fa-layer-group ml-2 text-blue-300"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†Ø§Øª
          </div>
          <div id="invList" class="space-y-2"></div>

          <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-2">
            <input id="newInvName" type="text"
              class="bg-slate-950/25 text-sm text-white px-3 py-2 rounded-2xl border border-slate-700/60 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/15 outline-none"
              placeholder="Ø§Ø³Ù… Ù…Ø®Ø²ÙˆÙ† Ø¬Ø¯ÙŠØ¯" />
            <button id="addInvBtn" class="press soft bg-blue-600 hover:bg-blue-500 text-white font-extrabold px-4 py-2 rounded-2xl text-sm">
              Ø¥Ø¶Ø§ÙØ©
            </button>
            <button id="resetRulesBtn" class="press soft bg-slate-800/50 hover:bg-slate-700/55 border border-slate-700/60 text-white font-bold px-4 py-2 rounded-2xl text-sm">
              Ø¥Ø¹Ø§Ø¯Ø© Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù†Ù‚Ù„
            </button>
          </div>

          <p class="mt-2 text-[11px] glow break-any">
            * Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ.
          </p>
        </div>

        <div class="bg-slate-950/18 border border-slate-700/35 rounded-2xl p-3">
          <div class="font-extrabold text-white mb-2">
            <i class="fa-solid fa-link ml-2 text-emerald-300"></i> Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mb-2">
            <input id="linkName" type="text"
              class="bg-slate-950/25 text-sm text-white px-3 py-2 rounded-2xl border border-slate-700/60 outline-none"
              placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø±" />
            <input id="linkUrl" type="url"
              class="bg-slate-950/25 text-sm text-white px-3 py-2 rounded-2xl border border-slate-700/60 outline-none"
              placeholder="https://..." />
            <button id="addLinkBtn" class="press soft bg-emerald-600 hover:bg-emerald-500 text-white font-extrabold px-4 py-2 rounded-2xl text-sm">
              Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø·
            </button>
          </div>

          <div class="flex items-center gap-2 mb-2">
            <label class="text-xs text-slate-200">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰:</label>
            <input id="maxLinksInput" type="number" min="0" step="1"
              class="w-24 bg-slate-950/25 text-sm text-white px-3 py-2 rounded-2xl border border-slate-700/60 outline-none" />
            <button id="saveMaxLinksBtn" class="press soft bg-slate-800/50 hover:bg-slate-700/55 border border-slate-700/60 text-white font-bold px-4 py-2 rounded-2xl text-sm">
              Ø­ÙØ¸
            </button>
          </div>

          <div id="linksList" class="space-y-2"></div>
          <p class="mt-2 text-[11px] glow break-any">* Ù„Ù† ÙŠØ¸Ù‡Ø± Ø²Ø± Ø¨Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ø£Ø¶ÙØªÙ‡ Ù‡Ù†Ø§.</p>
        </div>

        <div class="bg-slate-950/18 border border-slate-700/35 rounded-2xl p-3 lg:col-span-2">
          <div class="font-extrabold text-white mb-2">
            <i class="fa-solid fa-sliders ml-2 text-purple-300"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù‡Ù…Ø©
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-sm">
            <label class="flex items-center gap-2 bg-slate-950/20 border border-slate-700/40 rounded-2xl px-3 py-2">
              <input id="toggleSnow" type="checkbox" class="accent-blue-500"><span>Ø«Ù„Ø¬ Ø®ÙÙŠÙ</span>
            </label>
            <label class="flex items-center gap-2 bg-slate-950/20 border border-slate-700/40 rounded-2xl px-3 py-2">
              <input id="toggleSmart" type="checkbox" class="accent-blue-500"><span>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù„Ø®Øµ</span>
            </label>
            <label class="flex items-center gap-2 bg-slate-950/20 border border-slate-700/40 rounded-2xl px-3 py-2">
              <input id="toggleFeed" type="checkbox" class="accent-blue-500"><span>Ù‚Ø³Ù… Ø§Ù„ØªØºØ°ÙŠØ©</span>
            </label>
          </div>

          <div class="mt-3 flex flex-wrap gap-2 justify-between">
            <button id="saveSettingsBtn" class="press soft bg-purple-600 hover:bg-purple-500 text-white font-extrabold px-5 py-2.5 rounded-2xl text-sm">
              Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
            <button id="resetAllBtn" class="press soft bg-red-700/18 hover:bg-red-700/25 border border-red-700/25 text-red-100 font-bold px-5 py-2.5 rounded-2xl text-sm">
              ØªØµÙÙŠØ± ÙƒÙ„ Ø´ÙŠØ¡
            </button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
  (() => {
    const $ = (id) => document.getElementById(id);
    const on = (el, ev, fn, opt) => el && el.addEventListener(ev, fn, opt);

    // DOM
    const stockCountEl=$('stockCount'), pulledCountEl=$('pulledCount'), titleNameEl=$('titleName'), tabsWrap=$('tabsWrap'), homeLinksEl=$('homeLinks');
    const inputSectionEl=$('inputSection'), bulkInputEl=$('bulkInput'), quickInputEl=$('quickInput');
    const searchInputEl=$('searchInput'), smartStatsBtn=$('smartStatsBtn'), smartPanel=$('smartPanel'), smartSummary=$('smartSummary');
    const clearSearchBtn=$('clearSearchBtn'), copyCompactBtn=$('copyCompactBtn'), undoPullBtn=$('undoPullBtn');
    const resultAreaEl=$('resultArea'), timestampEl=$('timestamp');
    const emailDisplayEl=$('emailDisplay'), passDisplayEl=$('passDisplay'), recDisplayEl=$('recDisplay'), urlBtnEl=$('urlBtn');
    const toggleBtn=$('toggleBtn'), clearBtn=$('clearBtn'), addBtn=$('addBtn'), pullBtn=$('pullBtn');
    const copyFullBtn=$('copyFullBtn'), copyEPBtn=$('copyEPBtn');
    const restoreBtn=$('restoreBtn'), deleteLastBtn=$('deleteLastBtn'), moveBtn=$('moveBtn'), moveTargetsEl=$('moveTargets');
    const importFile=$('importFile'), exportBtn=$('exportBtn'), exportRemainingBtn=$('exportRemainingBtn');

    // toast
    const toast=$('toast'), toastMsg=$('toastMsg'), toastIcon=$('toastIcon');
    let toastTimeout;
    const flash = (el)=>{ if(!el) return; el.classList.remove('flash'); void el.offsetWidth; el.classList.add('flash'); setTimeout(()=>el.classList.remove('flash'),260); };
    const showToast=(msg,type='info')=>{
      toastMsg.textContent=msg;
      toast.className="fixed bottom-5 right-5 left-auto px-5 py-3 rounded-2xl shadow-2xl transform transition-all duration-300 z-[70] flex items-center gap-3 font-bold border";
      const set=(bg,br,tx,ic)=>{ toast.classList.add(bg,br,tx); toastIcon.className=ic; };
      if(type==='success') set('bg-emerald-950/80','border-emerald-800/60','text-emerald-100',"fa-solid fa-circle-check text-emerald-300");
      else if(type==='error') set('bg-red-950/80','border-red-800/60','text-red-100',"fa-solid fa-triangle-exclamation text-red-300");
      else if(type==='copy') set('bg-blue-950/80','border-blue-800/60','text-blue-100',"fa-solid fa-copy text-blue-300");
      else set('bg-slate-900/90','border-slate-700/70','text-white',"fa-solid fa-info-circle text-slate-200");
      toast.classList.remove('translate-y-20','opacity-0');
      clearTimeout(toastTimeout);
      toastTimeout=setTimeout(()=>toast.classList.add('translate-y-20','opacity-0'),2200);
    };

    const copyText= async (text)=>{
      try{ if(navigator.clipboard && window.isSecureContext){ await navigator.clipboard.writeText(text); return true; } }catch(_){}
      try{
        const ta=document.createElement('textarea'); ta.value=text; ta.style.position='fixed'; ta.style.top='-9999px';
        document.body.appendChild(ta); ta.focus(); ta.select();
        const ok=document.execCommand('copy'); ta.remove(); return ok;
      }catch(_){ return false; }
    };

    // safer clone (Ø¨Ø¯ÙŠÙ„ structuredClone)
    const clone = (x)=> JSON.parse(JSON.stringify(x));

    const CONFIG_KEY='smartInventory_config_v1_user';
    const defaultConfig={
      inventories:[{id:'main',name:'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ',locked:true},{id:'gemini',name:'Gemini',locked:false},{id:'go',name:'Go',locked:false}],
      moveRules:{ main:['gemini','go'], go:['main','gemini'], gemini:['go'] },
      links:[], maxLinks:5, ui:{ snow:true, smart:true, feed:true }
    };

    const safeJson=(v,f)=>{ try{return JSON.parse(v);}catch{return f;} };
    let config = (() => {
      const v=localStorage.getItem(CONFIG_KEY);
      if(!v) return clone(defaultConfig);
      const c=safeJson(v,null);
      if(!c) return clone(defaultConfig);
      const m=clone(defaultConfig);
      Object.assign(m,c);
      m.ui=Object.assign(clone(defaultConfig.ui), c.ui||{});
      m.links=Array.isArray(c.links)?c.links:[];
      m.inventories=Array.isArray(c.inventories)&&c.inventories.length?c.inventories:clone(defaultConfig.inventories);
      m.moveRules=Object.assign(clone(defaultConfig.moveRules), c.moveRules||{});
      m.maxLinks=Number.isFinite(c.maxLinks)?c.maxLinks:defaultConfig.maxLinks;
      return m;
    })();
    const saveConfig=()=>localStorage.setItem(CONFIG_KEY, JSON.stringify(config));

    const invName=(id)=>{
      const inv=(config.inventories||[]).find(x=>x.id===id);
      if(!inv) return id;
      if(inv.id==='go') return 'ChatGPT';
      return inv.name;
    };
    const serviceLabel=(id)=>{
      if(id==='go') return 'ChatGPT Ø³Ù†ÙˆÙŠ';
      if(id==='gemini') return 'Gemini Ø³Ù†ÙˆÙŠ';
      if(id==='main') return 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø³Ù†ÙˆÙŠ';
      return `${invName(id)} Ø³Ù†ÙˆÙŠ`;
    };

    const keysFor=(id)=>({ data:`smart_${id}_data`, pulled:`smart_${id}_pulled`, last:`smart_${id}_last`, undo:`smart_${id}_undo` });
    const store={};
    const ensureStore=(id)=> store[id] || (store[id]={ inventory:[], pulledCounter:0, currentAccount:null });

    const loadInv=(id)=>{
      const s=ensureStore(id), k=keysFor(id);
      s.inventory=safeJson(localStorage.getItem(k.data),[]);
      s.pulledCounter=Number(localStorage.getItem(k.pulled)||0)||0;
      s.currentAccount=safeJson(localStorage.getItem(k.last), null);
    };
    const saveInv=(id)=>{
      const s=ensureStore(id), k=keysFor(id);
      localStorage.setItem(k.data, JSON.stringify(s.inventory));
      localStorage.setItem(k.pulled, String(s.pulledCounter));
      if(s.currentAccount) localStorage.setItem(k.last, JSON.stringify(s.currentAccount));
    };
    const setUndo=(id,obj)=>localStorage.setItem(keysFor(id).undo, JSON.stringify(obj||null));
    const getUndo=(id)=>safeJson(localStorage.getItem(keysFor(id).undo), null);
    const clearLast=(id)=>localStorage.removeItem(keysFor(id).last);

    let activeInvId='main';

    const applySearch=(list)=>{
      const q=(searchInputEl.value||'').trim().toLowerCase();
      if(!q) return list;
      return list.filter(a=>String(a.email||'').toLowerCase().includes(q));
    };

    const setStockColor=(n)=>{
      stockCountEl.className = n===0 ? "text-2xl font-extrabold text-red-400"
        : n<5 ? "text-2xl font-extrabold text-amber-300"
        : "text-2xl font-extrabold text-emerald-300";
    };

    const displayResult=(acc)=>{
      if(!acc) return;
      resultAreaEl.classList.remove('hidden');
      emailDisplayEl.textContent=acc.email||'---';
      passDisplayEl.textContent=acc.password||'---';
      recDisplayEl.textContent=acc.recovery||'ØºÙŠØ± Ù…ØªÙˆÙØ±';
      urlBtnEl.href=(acc.url && acc.url!=='')?acc.url:'#';
      const now=new Date();
      try{ timestampEl.textContent = now.toLocaleTimeString('ar-IQ',{hour:'2-digit',minute:'2-digit',second:'2-digit'}); }
      catch{ timestampEl.textContent = now.toLocaleTimeString(); }
    };

    const updateTitle=()=> titleNameEl.textContent = (activeInvId==='main') ? 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ' : `Ù…Ø®Ø²ÙˆÙ† ${invName(activeInvId)}`;

    const strength=(p)=>{
      if(!p) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
      let s=0;
      if(p.length>=10) s++;
      if(/[A-Z]/.test(p)) s++;
      if(/[0-9]/.test(p)) s++;
      if(/[^A-Za-z0-9]/.test(p)) s++;
      return s<=1?'Ø¶Ø¹ÙŠÙ':(s===2?'Ù…ØªÙˆØ³Ø·':'Ù‚ÙˆÙŠ');
    };

    const updateSmartSummary=()=>{
      const s=ensureStore(activeInvId);
      const list=applySearch(s.inventory);
      const last=s.currentAccount;
      const tabName=(activeInvId==='main')?'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ':invName(activeInvId);
      const now = (()=>{ try{return new Date().toLocaleDateString('ar-IQ');}catch{return new Date().toLocaleDateString();} })();
      smartSummary.textContent =
        `Ø§Ù„ØªØ¨ÙˆÙŠØ¨: ${tabName} â€” Ø§Ù„ØªØ§Ø±ÙŠØ®: ${now} â€” Ø§Ù„Ù…ØªØ§Ø­ (Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«): ${list.length} â€” ` +
        `Ø§Ù„Ù…Ø³Ø­ÙˆØ¨: ${s.pulledCounter} â€” ` +
        (last ? `Ø¢Ø®Ø± Ø­Ø³Ø§Ø¨: ${last.email} (Ù‚ÙˆØ© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯: ${strength(last.password)})` : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨ Ø­Ø§Ù„ÙŠØ§Ù‹');
    };

    const renderTabs=()=>{
      tabsWrap.innerHTML='';
      (config.inventories||[]).forEach(inv=>{
        const btn=document.createElement('button');
        btn.className=`press soft px-4 py-2 rounded-2xl text-sm font-bold border ${inv.id===activeInvId?'border-blue-400/50 bg-blue-500/10 shadow-[0_0_0_3px_rgba(59,130,246,.12)]':'border-slate-600/40 bg-slate-950/30'}`;
        const icon = inv.id==='main'?'fa-layer-group text-blue-300' : inv.id==='gemini'?'fa-wand-magic-sparkles text-purple-300' : inv.id==='go'?'fa-robot text-emerald-300' : 'fa-layer-group text-amber-300';
        btn.innerHTML=`<i class="fa-solid ${icon} ml-2"></i>${invName(inv.id)}`;
        btn.onclick=()=>setActive(inv.id);
        tabsWrap.appendChild(btn);
      });
    };

    const renderMoveButtons=()=>{
      moveTargetsEl.innerHTML='';
      moveTargetsEl.classList.add('hidden');
      const rules=config.moveRules||{};
      const targets=Array.isArray(rules[activeInvId])?rules[activeInvId]:[];
      const valid=targets.filter(t=>t!==activeInvId && (config.inventories||[]).some(i=>i.id===t));
      if(!valid.length){ moveBtn.style.opacity='0.5'; moveBtn.style.pointerEvents='none'; return; }
      moveBtn.style.opacity='1'; moveBtn.style.pointerEvents='';
      valid.forEach(t=>{
        const b=document.createElement('button');
        b.className="press soft bg-purple-700/18 hover:bg-purple-700/25 border border-purple-700/25 text-purple-100 font-bold py-2 px-4 rounded-2xl text-sm";
        b.textContent = (activeInvId==='go' && t==='main') ? 'Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠ' : `Ù†Ù‚Ù„ Ø¥Ù„Ù‰ ${invName(t)}`;
        b.onclick=()=>moveCurrentTo(t);
        moveTargetsEl.appendChild(b);
      });
    };

    const updateUI=()=>{
      const s=ensureStore(activeInvId);
      const filtered=applySearch(s.inventory);
      stockCountEl.textContent=filtered.length;
      pulledCountEl.textContent=s.pulledCounter;
      setStockColor(filtered.length);
      updateTitle();
      renderTabs();
      renderMoveButtons();
      if(config.ui.smart) updateSmartSummary();
      if(s.currentAccount) displayResult(s.currentAccount); else resultAreaEl.classList.add('hidden');
    };

    const setActive=(id)=>{
      activeInvId=id;
      if(!store[id]) loadInv(id);
      updateUI();
      showToast(`ØªÙ… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰: ${invName(id)}`,'info');
    };

    // Parsing
    const parseStandard=(line)=>{
      const parts=line.split(';').map(x=>x.trim());
      if(parts.length<2) return null;
      const [email,password]=parts;
      const recovery=parts[2]||'ØºÙŠØ± Ù…ØªÙˆÙØ±';
      const url=parts[3]||'#';
      if(!email || !password || !email.includes('@')) return null;
      return {email,password,recovery,url};
    };
    const parseQuick=(line)=>{
      const m=line.match(/^([^\s@]+@[^\s@]+\.[^\s@]+)(.+)$/);
      if(!m) return null;
      const email=(m[1]||'').trim(), password=(m[2]||'').trim();
      if(!email || !password) return null;
      return {email,password,recovery:'ØºÙŠØ± Ù…ØªÙˆÙØ±',url:'#'};
    };

    const addTextToStock=(text)=>{
      const s=ensureStore(activeInvId);
      text=String(text||'').replace(/\u0000/g,'').replace(/^\uFEFF/,'');
      const lines=text.replace(/\r/g,'').split('\n').map(x=>x.trim()).filter(Boolean);

      let added=0, dup=0, bad=0, header=0;
      const exists=(email)=>s.inventory.some(a=>a.email===email);

      for(const raw of lines){
        const low=raw.toLowerCase();
        if(raw.startsWith('{') || low.includes('{login}') || low.includes('login};{password') || low.includes('email;pass;') || low.includes('email;password')){
          header++; continue;
        }
        let acc=null;
        if(raw.includes(';')) acc=parseStandard(raw);
        else if(raw.includes(',')) acc=parseStandard(raw.replace(/,/g,';'));
        else acc=parseQuick(raw);

        if(!acc){ bad++; continue; }
        if(exists(acc.email)){ dup++; continue; }
        s.inventory.push(acc); added++;
      }

      saveInv(activeInvId);
      updateUI();

      if(!added && (bad||header)) showToast(`Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø´ÙŠØ¡. (Ù‡ÙŠØ¯Ø±: ${header} | ØºÙŠØ± ØµØ§Ù„Ø­: ${bad})`,'error');
      else{
        let msg=`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${added} Ø­Ø³Ø§Ø¨`;
        if(header) msg+=` (ØªØ¬Ø§Ù‡Ù„ Ù‡ÙŠØ¯Ø±: ${header})`;
        if(dup) msg+=` (Ù…ÙƒØ±Ø±: ${dup})`;
        if(bad) msg+=` (ØºÙŠØ± ØµØ§Ù„Ø­: ${bad})`;
        showToast(msg, added?'success':'error');
      }
    };

    const addToStock=()=>{
      flash(addBtn);
      const a=bulkInputEl.value||'', b=quickInputEl.value||'';
      if(!a.trim() && !b.trim()) return showToast('Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙØ§Ø±ØºØ©!','error');
      addTextToStock((a?a+'\n':'')+(b?b+'\n':''));
      bulkInputEl.value=''; quickInputEl.value='';
    };

    const pullAccount=()=>{
      flash(pullBtn);
      const s=ensureStore(activeInvId);
      const filtered=applySearch(s.inventory);
      if(!filtered.length) return showToast('Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙØ§Ø±Øº (Ø£Ùˆ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø¨Ø­Ø«).','error');

      let idx=0;
      if((searchInputEl.value||'').trim()){
        const first=filtered[0].email;
        idx=s.inventory.findIndex(a=>a.email===first);
        if(idx<0) idx=0;
      }

      const acc=s.inventory.splice(idx,1)[0];
      s.currentAccount=acc;
      s.pulledCounter++;
      setUndo(activeInvId,{acc,idx,time:Date.now()});
      saveInv(activeInvId);
      displayResult(acc);
      updateUI();
      showToast('ØªÙ… Ø³Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­','success');
    };

    const undoLastPull=()=>{
      flash(undoPullBtn);
      const u=getUndo(activeInvId);
      if(!u||!u.acc) return showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ© Ø³Ø­Ø¨ Ù„Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§.','error');
      const s=ensureStore(activeInvId);
      const idx=Number.isFinite(u.idx)?Math.max(0,Math.min(u.idx,s.inventory.length)):0;
      if(!s.inventory.some(a=>a.email===u.acc.email)) s.inventory.splice(idx,0,u.acc);
      if(s.pulledCounter>0) s.pulledCounter--;
      s.currentAccount=null;
      clearLast(activeInvId);
      setUndo(activeInvId,null);
      saveInv(activeInvId);
      updateUI();
      showToast('ØªÙ… Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø¢Ø®Ø± Ø³Ø­Ø¨','success');
    };

    const clearStorage=()=>{
      flash(clearBtn);
      if(!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù…Ø®Ø²ÙˆÙ† (${invName(activeInvId)}) Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ`)) return;
      const s=ensureStore(activeInvId);
      s.inventory=[]; s.pulledCounter=0; s.currentAccount=null;
      const k=keysFor(activeInvId);
      Object.values(k).forEach(x=>localStorage.removeItem(x));
      updateUI();
      showToast('ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†','success');
    };

    const copyField= async (type)=>{
      const s=ensureStore(activeInvId), acc=s.currentAccount;
      if(!acc) return showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨ Ù„Ù„Ù†Ø³Ø®.','error');
      const map={ email:['Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„',acc.email], password:['Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯',acc.password], recovery:['Ø§Ù„ØªØ­Ù‚Ù‚',acc.recovery] };
      const [label,val]=map[type]||['', ''];
      const ok=await copyText(String(val||''));
      showToast(ok?`ØªÙ… Ù†Ø³Ø® ${label}`:'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®', ok?'copy':'error');
    };

    const copyFull= async ()=>{
      flash(copyFullBtn);
      const s=ensureStore(activeInvId), acc=s.currentAccount;
      if(!acc) return showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨.','error');
      const t=`Ø§Ù„Ø§ÙŠÙ…ÙŠÙ„: ${acc.email}\nØ§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯: ${acc.password}\nØ§Ù„ØªØ­Ù‚Ù‚: ${acc.recovery}\nØ±Ø§Ø¨Ø· Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${acc.url||"#"}`;
      const ok=await copyText(t);
      showToast(ok?'ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙƒØ§Ù…Ù„Ø©':'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®', ok?'success':'error');
    };

    const copyEP= async ()=>{
      flash(copyEPBtn);
      const s=ensureStore(activeInvId), acc=s.currentAccount;
      if(!acc) return showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨.','error');
      const t=`${serviceLabel(activeInvId)}\n\nØ§Ù„Ø§ÙŠÙ…ÙŠÙ„: ${acc.email}\nØ§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯: ${acc.password}\n`;
      const ok=await copyText(t);
      showToast(ok?'ØªÙ… Ù†Ø³Ø® Email + Pass':'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®', ok?'copy':'error');
    };

    const copyCompact= async ()=>{
      flash(copyCompactBtn);
      const s=ensureStore(activeInvId), acc=s.currentAccount;
      if(!acc) return showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨.','error');
      const line=`${acc.email};${acc.password};${acc.recovery||'ØºÙŠØ± Ù…ØªÙˆÙØ±'};${acc.url||'#'}`;
      const ok=await copyText(line);
      showToast(ok?'ØªÙ… Ù†Ø³Ø® Ø¢Ø®Ø± Ø­Ø³Ø§Ø¨ (Ø³Ø·Ø± ÙˆØ§Ø­Ø¯)':'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®', ok?'copy':'error');
    };

    const restoreLastPulled=()=>{
      flash(restoreBtn);
      const s=ensureStore(activeInvId), acc=s.currentAccount;
      if(!acc) return showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨ Ù„Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹.','error');
      if(!s.inventory.some(a=>a.email===acc.email)) s.inventory.unshift(acc);
      if(s.pulledCounter>0) s.pulledCounter--;
      s.currentAccount=null;
      clearLast(activeInvId);
      saveInv(activeInvId);
      updateUI();
      showToast('ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†','success');
    };

    const deleteLastPulled=()=>{
      flash(deleteLastBtn);
      const s=ensureStore(activeInvId);
      if(!s.currentAccount) return showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨.','error');
      s.currentAccount=null;
      clearLast(activeInvId);
      saveInv(activeInvId);
      resultAreaEl.classList.add('hidden');
      showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©','success');
    };

    const moveCurrentTo=(target)=>{
      const sFrom=ensureStore(activeInvId), acc=sFrom.currentAccount;
      if(!acc) return showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø­ÙˆØ¨ Ù„Ù„Ù†Ù‚Ù„.','error');

      const allowed=(config.moveRules && Array.isArray(config.moveRules[activeInvId]))?config.moveRules[activeInvId]:[];
      if(!allowed.includes(target)) return showToast('Ø§Ù„Ù†Ù‚Ù„ ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø­Ø³Ø¨ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯.','error');

      loadInv(target);
      const sTo=ensureStore(target);
      if(sTo.inventory.some(a=>a.email===acc.email)) return showToast(`Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ ${invName(target)}.`,'error');

      sTo.inventory.unshift(acc);
      saveInv(target);
      sFrom.currentAccount=null;
      clearLast(activeInvId);
      saveInv(activeInvId);
      updateUI();
      showToast(`ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¥Ù„Ù‰ ${invName(target)}`,'success');
    };

    // TXT import/export
    const readFileText = (file)=> new Promise((res,rej)=>{
      const fr=new FileReader();
      fr.onerror=()=>rej(fr.error||new Error('FileReader error'));
      fr.onload=()=>{
        try{
          const u8=new Uint8Array(fr.result);
          const tryDec=(enc)=>{ try{ return new TextDecoder(enc,{fatal:false}).decode(u8); }catch{return null;} };
          const tries=[tryDec('utf-8'),tryDec('utf-16le'),tryDec('utf-16be'),tryDec('windows-1256'),tryDec('iso-8859-1')].filter(Boolean);
          const score=(s)=>{ const rep=(s.match(/\uFFFD/g)||[]).length; return s.trim().length - rep*2; };
          let best=tries[0]||'';
          for(const t of tries) if(score(t)>score(best)) best=t;
          best=String(best||'').replace(/\u0000/g,'').replace(/^\uFEFF/,'');
          res(best);
        }catch(e){ rej(e); }
      };
      fr.readAsArrayBuffer(file);
    });

    const importTxtFile= async (file)=>{
      if(!file) return showToast('Ù…Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù.','error');
      if(!file.size) return showToast('Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº.','error');
      try{
        const content=await readFileText(file);
        if(!content.trim()) return showToast('ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„ÙƒÙ† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙØ§Ø±Øº.','error');
        addTextToStock(content);
      }catch(e){
        console.error(e);
        showToast('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­.','error');
      }
    };

    const downloadTxt=(list,filename)=>{
      const content=list.map(a=>`${a.email};${a.password};${a.recovery};${a.url}`).join('\n');
      const blob=new Blob([content],{type:'text/plain;charset=utf-8'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a');
      a.href=url; a.download=filename;
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    };

    const exportFiltered=()=>{
      flash(exportBtn);
      const s=ensureStore(activeInvId);
      const list=applySearch(s.inventory);
      if(!list.length) return showToast('Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙØ§Ø±Øº (Ø£Ùˆ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø¨Ø­Ø«).','error');
      downloadTxt(list, `${activeInvId}_filtered_${new Date().toISOString().slice(0,10)}.txt`);
      showToast(`ØªÙ… ØªØµØ¯ÙŠØ± ${list.length} Ø­Ø³Ø§Ø¨ (Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«)`,'success');
    };

    const exportAll=()=>{
      flash(exportRemainingBtn);
      const s=ensureStore(activeInvId);
      if(!s.inventory.length) return showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„ØªØµØ¯ÙŠØ±.','error');
      downloadTxt(s.inventory, `${activeInvId}_remaining_${new Date().toISOString().slice(0,10)}.txt`);
      showToast(`ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„: ${s.inventory.length}`,'success');
    };

    // Links + Settings (Ù…Ø®ØªØµØ±)
    const settingsModal=$('settingsModal'), settingsBtn=$('settingsBtn'), closeSettingsBtn=$('closeSettingsBtn');
    const invList=$('invList'), newInvName=$('newInvName'), addInvBtn=$('addInvBtn'), resetRulesBtn=$('resetRulesBtn');
    const linkName=$('linkName'), linkUrl=$('linkUrl'), addLinkBtn=$('addLinkBtn'), linksList=$('linksList');
    const maxLinksInput=$('maxLinksInput'), saveMaxLinksBtn=$('saveMaxLinksBtn');
    const toggleSnow=$('toggleSnow'), toggleSmart=$('toggleSmart'), toggleFeed=$('toggleFeed'), saveSettingsBtn=$('saveSettingsBtn'), resetAllBtn=$('resetAllBtn');

    const renderHomeLinks=()=>{
      homeLinksEl.innerHTML='';
      const links=config.links||[];
      if(!links.length){ homeLinksEl.classList.add('hidden'); return; }
      homeLinksEl.classList.remove('hidden');
      links.forEach(l=>{
        const a=document.createElement('a');
        a.href=l.url; a.target="_blank"; a.rel="noopener";
        a.className="press soft px-3 py-2 rounded-2xl text-sm font-bold border border-slate-600/40 bg-slate-950/30 break-any";
        a.textContent=l.name;
        homeLinksEl.appendChild(a);
      });
    };

    const renderLinksList=()=>{
      linksList.innerHTML='';
      const links=config.links||[];
      if(!links.length){
        const d=document.createElement('div');
        d.className="text-[12px] glow"; d.textContent="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ø­Ø§Ù„ÙŠØ§Ù‹.";
        linksList.appendChild(d); return;
      }
      links.forEach((l,idx)=>{
        const row=document.createElement('div');
        row.className="flex items-center justify-between gap-2 bg-slate-950/20 border border-slate-700/40 rounded-2xl px-3 py-2";
        row.innerHTML=`
          <div class="min-w-0 break-any">
            <div class="font-bold text-white text-sm">${l.name}</div>
            <div class="text-[11px] text-slate-400">${l.url}</div>
          </div>
          <button class="press soft bg-red-700/18 hover:bg-red-700/25 border border-red-700/25 text-red-100 font-bold px-3 py-2 rounded-2xl text-xs" data-del-link="${idx}">Ø­Ø°Ù</button>
        `;
        linksList.appendChild(row);
      });
      linksList.querySelectorAll('[data-del-link]').forEach(btn=>{
        btn.onclick=()=>{
          const i=Number(btn.getAttribute('data-del-link'));
          config.links.splice(i,1);
          saveConfig(); renderLinksList(); renderHomeLinks();
          showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø§Ø¨Ø·','success');
        };
      });
    };

    const addLink=()=>{
      flash(addLinkBtn);
      const name=(linkName.value||'').trim();
      const url=(linkUrl.value||'').trim();
      const max=Math.max(0,Math.floor(Number(config.maxLinks||0)));
      if(!name || !url) return showToast('Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ø§Ø¨Ø·','error');
      if(max===0) return showToast('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ø­Ø§Ù„ÙŠØ§Ù‹ 0. ØºÙŠÙ‘Ø±Ù‡ Ø£ÙˆÙ„Ø§Ù‹.','error');
      if((config.links||[]).length>=max) return showToast(`ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ (${max}).`,'error');
      try{ new URL(url); }catch{ return showToast('Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­','error'); }
      config.links.push({name,url});
      linkName.value=''; linkUrl.value='';
      saveConfig(); renderLinksList(); renderHomeLinks();
      showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø§Ø¨Ø·','success');
    };

    const saveMaxLinks=()=>{
      flash(saveMaxLinksBtn);
      const n=Math.max(0,Math.floor(Number(maxLinksInput.value||0)));
      config.maxLinks=n;
      if((config.links||[]).length>n) config.links=config.links.slice(0,n);
      saveConfig(); renderLinksList(); renderHomeLinks();
      showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø¯','success');
    };

    const slugify=(name)=>{
      const base=(name||'').toLowerCase().trim().replace(/[\u0600-\u06FF]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'');
      return base || ('inv-' + Math.random().toString(16).slice(2,8));
    };

    const renderInvList=()=>{
      invList.innerHTML='';
      (config.inventories||[]).forEach(inv=>{
        const row=document.createElement('div');
        row.className="flex items-center justify-between gap-2 bg-slate-950/20 border border-slate-700/40 rounded-2xl px-3 py-2";
        row.innerHTML=`
          <div class="min-w-0 break-any">
            <div class="font-bold text-white text-sm">${inv.id==='go'?'Go (ÙŠØ¸Ù‡Ø±: ChatGPT)':inv.name}</div>
            <div class="text-[11px] text-slate-400 font-mono">id: ${inv.id}</div>
          </div>
          <div class="flex gap-2 shrink-0">
            ${inv.locked?`<span class="text-[11px] glow">Ø±Ø¦ÙŠØ³ÙŠ</span>`:`<button class="press soft bg-red-700/18 hover:bg-red-700/25 border border-red-700/25 text-red-100 font-bold px-3 py-2 rounded-2xl text-xs" data-remove="${inv.id}">Ø­Ø°Ù</button>`}
          </div>
        `;
        invList.appendChild(row);
      });
      invList.querySelectorAll('[data-remove]').forEach(btn=>{
        btn.onclick=()=>removeInventory(btn.getAttribute('data-remove'));
      });
    };

    const addInventory=()=>{
      flash(addInvBtn);
      const name=(newInvName.value||'').trim();
      if(!name) return showToast('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†','error');
      if(name.length>18) return showToast('Ø§Ù„Ø§Ø³Ù… Ø·ÙˆÙŠÙ„ØŒ Ø®Ù„ÙŠ Ø£Ù‚ØµØ±','error');

      const id=slugify(name);
      if(config.inventories.some(x=>x.id===id)) return showToast('Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù…/Ø§Ù„Ù…Ø¹Ø±Ù Ù…ÙˆØ¬ÙˆØ¯. ØºÙŠÙ‘Ø± Ø§Ù„Ø§Ø³Ù….','error');

      config.inventories.push({id,name,locked:false});
      const hasGo=config.inventories.some(x=>x.id==='go');
      config.moveRules[id]=hasGo?['go']:['main'];

      saveConfig();
      newInvName.value='';
      loadInv(id);
      renderTabs(); renderInvList(); renderMoveButtons();
      showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø²ÙˆÙ† Ø¬Ø¯ÙŠØ¯','success');
    };

    const removeInventory=(id)=>{
      const inv=config.inventories.find(x=>x.id===id);
      if(!inv || inv.locked) return;
      if(!confirm(`Ø­Ø°Ù Ù…Ø®Ø²ÙˆÙ† (${invName(id)})ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ Ø£ÙŠØ¶Ø§Ù‹.`)) return;

      config.inventories=config.inventories.filter(x=>x.id!==id);
      for(const k in (config.moveRules||{})) config.moveRules[k]=(config.moveRules[k]||[]).filter(x=>x!==id);
      delete config.moveRules[id];

      const k=keysFor(id);
      Object.values(k).forEach(x=>localStorage.removeItem(x));

      if(activeInvId===id) activeInvId='main';
      saveConfig();
      setActive(activeInvId);
      renderInvList();
      showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø®Ø²ÙˆÙ†','success');
    };

    const resetMoveRules=()=>{
      flash(resetRulesBtn);
      config.moveRules=clone(defaultConfig.moveRules);
      saveConfig();
      renderInvList();
      renderMoveButtons();
      showToast('ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù†Ù‚Ù„','success');
    };

    const applyUiToggles=()=>{
      $('snowCanvas').style.display = config.ui.snow ? '' : 'none';
      smartStatsBtn.style.display = config.ui.smart ? '' : 'none';
      if(!config.ui.smart) smartPanel.classList.add('hidden');
      const feedSection=inputSectionEl?.closest('section');
      if(feedSection) feedSection.style.display = config.ui.feed ? '' : 'none';
    };

    const saveUiSettings=()=>{
      flash(saveSettingsBtn);
      config.ui.snow=!!toggleSnow.checked;
      config.ui.smart=!!toggleSmart.checked;
      config.ui.feed=!!toggleFeed.checked;
      saveConfig();
      applyUiToggles();
      updateUI();
      showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª','success');
    };

    const resetAll=()=>{
      flash(resetAllBtn);
      if(!confirm('ØªØµÙÙŠØ± ÙƒÙ„ Ø´ÙŠØ¡ØŸ (ÙƒÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†Ø§Øª + Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)')) return;

      const ids=new Set([...(config.inventories||[]).map(x=>x.id), ...(defaultConfig.inventories||[]).map(x=>x.id)]);
      ids.forEach(id=>{
        const k=keysFor(id);
        Object.values(k).forEach(x=>localStorage.removeItem(x));
      });
      localStorage.removeItem(CONFIG_KEY);

      config=clone(defaultConfig);
      activeInvId='main';
      for(const k in store) delete store[k];

      loadAll();
      renderTabs(); renderHomeLinks(); applyUiToggles();
      setActive('main');
      showToast('ØªÙ… Ø§Ù„ØªØµÙÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„','success');
    };

    const openSettings=()=>{
      flash(settingsBtn);
      renderInvList(); renderLinksList();
      maxLinksInput.value=String(config.maxLinks ?? 5);
      toggleSnow.checked=!!config.ui.snow;
      toggleSmart.checked=!!config.ui.smart;
      toggleFeed.checked=!!config.ui.feed;
      settingsModal.classList.add('open');
      document.body.style.overflow='hidden';
    };
    const closeSettings=()=>{
      flash(closeSettingsBtn);
      settingsModal.classList.remove('open');
      document.body.style.overflow='';
    };

    // Events
    on(toggleBtn,'click',()=>{ flash(toggleBtn); inputSectionEl.classList.toggle('hidden'); });
    on(clearBtn,'click',clearStorage);
    on(addBtn,'click',addToStock);
    on(pullBtn,'click',pullAccount);

    on(smartStatsBtn,'click',()=>{ flash(smartStatsBtn); smartPanel.classList.toggle('hidden'); updateSmartSummary(); });
    on(clearSearchBtn,'click',()=>{ flash(clearSearchBtn); searchInputEl.value=''; updateUI(); });
    on(copyCompactBtn,'click',copyCompact);
    on(undoPullBtn,'click',undoLastPull);
    on(searchInputEl,'input',updateUI);

    on(copyFullBtn,'click',copyFull);
    on(copyEPBtn,'click',copyEP);

    on(restoreBtn,'click',restoreLastPulled);
    on(deleteLastBtn,'click',deleteLastPulled);

    document.querySelectorAll('[data-copy]').forEach(card=> on(card,'click',()=>{ flash(card); copyField(card.getAttribute('data-copy')); }) );
    on(moveBtn,'click',()=>{ flash(moveBtn); moveTargetsEl.classList.toggle('hidden'); });

    on(importFile,'change', async ()=>{
      const file=importFile.files && importFile.files[0] ? importFile.files[0] : null;
      await importTxtFile(file);
      importFile.value='';
    });

    on(exportBtn,'click',exportFiltered);
    on(exportRemainingBtn,'click',exportAll);

    // Settings events
    on(settingsBtn,'click',openSettings);
    on(closeSettingsBtn,'click',closeSettings);
    on(settingsModal,'click',(e)=>{ if(e.target===settingsModal) closeSettings(); });

    on(addInvBtn,'click',addInventory);
    on(resetRulesBtn,'click',resetMoveRules);

    on(addLinkBtn,'click',addLink);
    on(saveMaxLinksBtn,'click',saveMaxLinks);

    on(saveSettingsBtn,'click',saveUiSettings);
    on(resetAllBtn,'click',resetAll);

    const loadAll=()=> (config.inventories||[]).forEach(inv=>loadInv(inv.id));

    // Init
    window.addEventListener('load',()=>{
      loadAll();
      renderTabs();
      renderHomeLinks();
      applyUiToggles();
      setActive('main');
    });

    // Snow (Ø®ÙÙŠÙ)
    const canvas=$('snowCanvas'), ctx=canvas.getContext('2d',{alpha:true});
    let W=0,H=0;
    const resize=()=>{ W=canvas.width=innerWidth; H=canvas.height=innerHeight; };
    on(window,'resize',resize,{passive:true}); resize();

    const flakes=Array.from({length:50},()=>({ x:Math.random()*W,y:Math.random()*H,r:.6+Math.random()*1.6,v:.25+Math.random()*.9,dr:(Math.random()*.6)-.3,a:.12+Math.random()*.20 }));
    (function tick(){
      if(config.ui.snow){
        ctx.clearRect(0,0,W,H);
        for(const f of flakes){
          f.y+=f.v; f.x+=f.dr;
          if(f.y>H+5){ f.y=-5; f.x=Math.random()*W; }
          if(f.x>W+5) f.x=-5;
          if(f.x<-5) f.x=W+5;
          ctx.beginPath(); ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
          ctx.fillStyle=`rgba(255,255,255,${f.a})`; ctx.fill();
        }
      }
      requestAnimationFrame(tick);
    })();

  })();
  </script>
</body>
</html>
